(function(g){var window=this;'use strict';var tBG=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh,OM,q7,u_,i_,p8,G5,km,Kc,lF,eb,C,ar,e_,qQ,jb,Qo,pc,yB,U7,K,x,e,k,Q,or,U,J;return g.R(function(M){switch(M.L){case 1:return l=My(a),y=a.entityKey,S=g.xj(y).entityId,n=[],V=!1,S==="!*$_ALL_ENTITIES_!*$"?(V=!0,g.u(M,mi(p.L,"musicAlbumRelease"),5)):g.u(M,tS(p.L,y,"musicAlbumRelease"),4);case 4:(z=M.S)&&n.push(z);M.g7(3);break;case 5:n=M.S;case 3:if((d=n)==null||!d.length)return M.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l));if(V){G=[];B=g.t(n);for(c=B.next();!c.done;c=B.next())r=c.value,w=g.xj(r.id).entityId,G.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w,"musicAlbumRelease",0,Hm));return M.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,G))}P=[];F=n[0];v=void 0;if(!F.downloadMetadata){M.g7(6);break}return g.u(M,tS(p.L,F.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:I=M.S,v=Number((O=(b=I)==null?void 0:b.addedTimestampMillis)!=null?O:"0")/1E3;case 6:return g.$r(M,8),
g.u(M,m8c(p,S,(m=v)==null?void 0:m.toString()),10);case 10:P=M.S;g.L8(M,9);break;case 8:H=g.L6(M);if(!(H instanceof Error&&H.message==="No data")){if(H instanceof Error&&H.message==="Empty response body")Dy(H.message);else return Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.ka&&H.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,Y,N));M.g7(9);break}return g.u(M,iA(S,"musicAlbumRelease",p.L,a,p.U),9);case 9:yo=[];zq=new Map;if((S$=P)==null?0:S$.length)for(BE=g.t(P),f=BE.next();!f.done;f=BE.next())xh=f.value,Nf=xh.offlineVideoData,nc=void 0,((nc=Nf)==null?0:nc.videoId)&&zq.set(Nf.videoId,Nf);yU=new Map;kh=[];if((OM=F)==null?0:(q7=OM.tracks)==null?0:q7.length)for(u_=g.t(F.tracks),i_=u_.next();!i_.done;i_=u_.next())if(p8=i_.value,G5=g.xj(p8).entityId)zq.has(G5)?
(yU.set(G5,zq.get(G5)),zq.delete(G5)):kh.push(G5);Kc=Number(((km=a.actionMetadata)==null?void 0:km.priority)||0)+1;lF=g.t(zq.entries());for(eb=lF.next();!eb.done;eb=lF.next())C=eb.value,ar=g.t(C),e_=ar.next().value,qQ=ar.next().value,jb=e_,Qo=qQ,yo.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",jb,"musicTrack",Kc,Hm,Ty(a,Qo)));pc=g.t(yU.entries());for(yB=pc.next();!yB.done;yB=pc.next())U7=yB.value,K=g.t(U7),x=K.next().value,e=K.next().value,k=x,Q=e,yo.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
k,"musicTrack",Kc,Hm,Ty(a,Q)));or=g.t(kh);for(U=or.next();!U.done;U=or.next())J=U.value,yo.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",J,"musicTrack",0,Hm));return M.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,yo))}})},je_=function(p){var a=p.videos;
p=[];var l=[];if(a){a=g.t(a);for(var y=a.next();!y.done;y=a.next()){var S=y.value.offlineVideoData.videoId;y=g.m8(S,"musicTrack");S=g.m8(S,"musicTrackDownloadMetadataEntity");p.push(y);l.push(S)}}return{uR:p,td:l}},WLG=function(){Ny.apply(this,arguments)},HPa=function(){Ny.apply(this,arguments)},D81=function(){Ny.apply(this,arguments)},sJ=function(p,a){p.api.xv("onOfflineOperationFailure",a);
var l;(l=p.L)==null||l.postMessage(a)},iPc=function(){Ny.apply(this,arguments)},TM2=function(){Ny.apply(this,arguments)},NMb=function(){Ny.apply(this,arguments)},q9l=function(p,a){var l,y,S,n,V,z;
return g.R(function(d){switch(d.L){case 1:if(p.Z)return d.return();p.Z=!0;p.L=a;l=g.xj(p.L.key);y=l.entityId;S=void 0;if(p.L.transferState==="TRANSFER_STATE_TRANSFERRING")return g.u(d,UJ(p,y),7);if(p.L.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||p.L.transferRetryCount||p.L.hasLoggedFirstStarted){d.g7(3);break}return g.u(d,UJ(p,y),5);case 5:return S=d.S,p.L.hasLoggedFirstStarted=!0,g.u(d,sel(p),6);case 6:U8M({videoId:y,F_:p.L,offlineModeType:S},void 0,void 0,!0);d.g7(3);break;case 7:S=d.S,
QS({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:y,F_:p.L,offlineModeType:S});case 3:return g.u(d,Qe7(p),8);case 8:return n=null,g.$r(d,9),g.u(d,hwW(p,a),11);case 11:n=d.S;p.W=n;g.L8(d,10);break;case 9:return V=g.L6(d),Dy("error getting player response",V,a.cotn),g.u(d,p.Fk("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return d.return();case 10:return z=Afc(p.api.C(),a.cotn,n),g.u(d,gHc(p,z),13);case 13:return g.u(d,Y9c(z.videoId),
14);case 14:z.cI=d.S;var G=p.K,B=z,c=a.maximumDownloadQuality;B.getPlayerResponse();g.Uy(B.videoId,2);G.U=2;G.S=!1;var r;(r=G.player)==null||r.dispose();G.player=G.api.Y9(B);B={};G.player.xT((B.localmediachange=G.PR,B.signatureexpired=G.gw,B.statechange=G.paI,B),G);G.D("html5_generate_content_po_token")&&G.player.JG();c=G.VW(c);G.player.oE(g.UR(c,c,!0,"m"),!1);G.player.rI(!1);p.j.start(108E5);g.lD(d)}})},psG=function(p,a,l,y,S){var n,V,z,d,G,B;
return g.R(function(c){switch(c.L){case 1:if(n=y){c.g7(2);break}return g.u(c,Jfa([a]),3);case 3:V=c.S,n=V[0];case 2:return g.u(c,fz2(p,n,l,S),4);case 4:z=c.S;d=z.mainVideoEntity;G=z.channelEntity;g.$r(c,5);var r=hS(d.thumbnail),w=hS(G.avatar);return g.u(c,AS(r.concat(w)),7);case 7:g.L8(c,0);break;case 5:B=g.L6(c),B instanceof Error&&B.message==="Failed to fetch"&&Dy(B.message),g.lD(c)}})},an7=function(p,a){p=g.t(p.actions);
for(var l=p.next();!l.done;l=p.next())if(l.value.actionId===a)return!0;return!1},lnc=function(){Ny.apply(this,arguments)},ykG=function(){Ny.apply(this,arguments)},SO1=function(){Ny.apply(this,arguments)},nPb=function(){Ny.apply(this,arguments)},gL=function(p){this.L=p},Voc=function(){Ny.apply(this,arguments)},ZlB=function(){g.N_.apply(this,arguments);
var p=this;this.events=new g.hm(this);this.Y=this.player.C();this.hg={Da7:function(){return p.L},
qj:function(){return p.qj()},
GN:function(a){return p.GN(a)}}},oPU=function(){Ny.apply(this,arguments)},zyl=function(){Ny.apply(this,arguments)},rkU=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P;
return g.R(function(F){switch(F.L){case 1:return l=My(a),y=g.xj(a.entityKey),S=y.entityId,n=g.T(a.actionMetadata,d$c),g.$r(F,2),g.u(F,GXb(p,S,void 0,(V=n)==null?void 0:V.track,(z=n)==null?void 0:z.albumRelease),4);case 4:if((d=n)==null?0:d.playlistId){F.g7(5);break}return g.u(F,BQW(p.L,a.entityKey),5);case 5:g.L8(F,3);break;case 2:return G=g.L6(F),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.ka&&G.type==="QUOTA_EXCEEDED"&&
(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),F.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,B,c));case 3:w=Number(((r=a.actionMetadata)==null?void 0:r.priority)||0)+1;var v=(v=g.T(a.actionMetadata,d$c))?{playbackDataActionMetadata:{maximumDownloadQuality:v.maximumDownloadQuality}}:void 0;P=Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S,"playbackData",w,ckU,v);return F.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l,[P]))}})},wsB=function(p){p.L&&(p.W=!0,Y6(p))},$$1=function(){Ny.apply(this,arguments)},LW1=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P;
return g.R(function(F){switch(F.L){case 1:return l=My(a),y=g.xj(a.entityKey),S=y.entityId,n=g.T(a.actionMetadata,qy),z=!((V=n)==null?0:V.playlistId),g.$r(F,2),g.u(F,psG(p,S,void 0,(d=n)==null?void 0:d.offlineVideoData,z),4);case 4:g.L8(F,3);break;case 2:return G=g.L6(F),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.ka&&G.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
F.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,B,c));case 3:r=1;r=Number(((w=a.actionMetadata)==null?void 0:w.priority)||0)+1;var v=(v=g.T(a.actionMetadata,qy))?{playbackDataActionMetadata:{maximumDownloadQuality:v.maximumDownloadQuality}}:void 0;P=Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",S,"playbackData",r,Pk2,v);return F.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,[P]))}})},pS=function(p,a,l,y){var S;
return g.R(function(n){if(n.L==1){if(!p.L)return JS(p,"saveTransferState: "+a),n.return();p.L.transferState=a;p.L.failureReason=y;g.$r(n,2);return g.u(n,sel(p,function(V){return l?fQ(V,"offlineVideoStreams",p.L.offlineVideoStreams).then(function(z){for(var d=g.t(z),G=d.next();!G.done;G=d.next())if((G=G.value)&&G.streamsProgress){G=g.t(G.streamsProgress);for(var B=G.next();!B.done;B=G.next())B.value.streamState=l}return Xs7(V,z.filter(function(c){return!!c}),"offlineVideoStreams")}):g.Qn.resolve(void 0)}),
4)}if(n.L!=2)return g.L8(n,0);
S=g.L6(n);return S instanceof g.ka&&S.type==="QUOTA_EXCEEDED"?g.u(n,p.Fk("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):n.g7(0)})},x$M=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},FWM=function(){Ny.apply(this,arguments)},vPU=function(p,a,l,y){g.D.call(this);
var S=this;this.S=p;this.api=a;this.r7=l;this.Xu=y;this.G=new g.RA;this.j=new g.l_(function(){S.L&&S.L.transferState==="TRANSFER_STATE_TRANSFERRING"&&S.G.Dd()&&((S.L.transferRetryCount||0)<3?a3(S.K,S.W,!1,!1):le(S.K,S.W.videoDetails.videoId),S.Fk("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.UO=this.QY=0;this.Sl=this.Z=!1;this.OO=g.sW(this.api.C().experiments,"html5_transfer_processing_logs_interval");this.nz=new g.hm(this);this.hg={ZNl:function(){return S.j},
BIY:function(){return S.Xu},
n5:function(){return S.G}};
this.w7=this.S.observe(this.Z9.bind(this));this.K=new EP2(a,this);this.Kz=new Ck_(a);this.Bs=new yf(this.S);this.Hs=this.G.listen("publicytnetworkstatus-online",this.G5.bind(this));this.t9=this.G.listen("publicytnetworkstatus-offline",this.g3l.bind(this));this.Sl=this.api.C().D("html5_less_transfer_processing_logs");g.E(this,this.nz);this.nz.J(a,"offlinetransferpause",this.b1m);if(g.Z0(this.api.C()))this.U="mainVideoDownloadStateEntity";else if(g.dB(this.api.C())||g.sf(this.api.C()))this.U="musicTrackDownloadMetadataEntity"},
KWb=function(p){p=(new TextEncoder).encode(p).subarray(0,16);
var a=new Uint8Array(16);a.set(p);return a},eyU=function(p){p=p.key||p.id;
if(!p)throw Error("Entity key is missing");return p},blM=function(){Ny.apply(this,arguments)},In2=function(){gL.apply(this,arguments)},Mo8=function(p,a,l,y){y=y===void 0?[]:y;
a={offlineOrchestrationContext:RyB(p,a,l,y)};a=u4a(3,a);Ol8(kXM(),a,p.rootActionId)},m$c=function(p,a,l){this.L=p;
this.Y=a;this.U=l},S7=function(p,a){return p.actionType===a.actionType&&p.entityKey===a.entityKey},toM=function(){Ny.apply(this,arguments)},jJM=function(p){return p instanceof Error?new nS("UNKNOWN_DECODE_ERROR",{originalMessage:p.message}):new nS("UNKNOWN_DECODE_ERROR")},WWG=function(){Ny.apply(this,arguments)},Hl2=function(){Ny.apply(this,arguments)},hyB=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f;
return g.R(function(xh){switch(xh.L){case 1:return l=My(a),y=[],g.u(xh,Vf.getInstance(),2);case 2:S=xh.S;if(!S){xh.g7(3);break}return g.u(xh,S.get("sdois"),4);case 4:return n=xh.S,g.u(xh,(z=S)==null?void 0:z.get("lmqf"),5);case 5:V=xh.S;case 3:g.$r(xh,6);if(n===void 0)throw Error("prefStorage or opt-in state is undefined");d=[];if(n){xh.g7(8);break}return g.u(xh,D$G(p.L),9);case 9:d=xh.S,d.reverse();case 8:if(!d.length){xh.g7(10);break}G=g.t(d);B=G.next();case 11:if(B.done){xh.g7(10);break}c=B.value;
if(!c){xh.g7(12);break}r=g.xj(c).entityId;return g.u(xh,ZZ(p.L,r),14);case 14:return w=xh.S,w.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.u(xh,o3(r,p.L,{entityKey:c,actionType:a.actionType},p.U,w),12);case 12:B=G.next();xh.g7(11);break;case 10:return g.u(xh,ilB(n,(P=V)!=null?P:"SD"),16);case 16:return F=xh.S,g.u(xh,TQ8(F),17);case 17:v=NQB(F);if(!p.Y.D("woffle_enable_main_downloads_library")){xh.g7(18);break}if(n){xh.g7(19);break}return g.u(xh,sJK(p.L,g.M2),19);case 19:return g.u(xh,
U$b(p.L,[g.M2]),18);case 18:if((I=v)==null?0:I.length)for(b=g.t(v),O=b.next();!O.done;O=b.next())if(H=m=O.value,Y=H.actionType,N=H.entityKey,yo=H.actionMetadata,Y&&N&&yo&&!g.T(yo,QJW)){Y==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(yo.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(zq=g.T(m.actionMetadata,qy))zq.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",m.actionMetadata=Object.assign({},m.actionMetadata,{mainVideoEntityActionMetadata:zq});y.push(m)}g.L8(xh,
7);break;case 6:return S$=g.L6(xh),BE="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S$ instanceof g.ka&&S$.type==="QUOTA_EXCEEDED"&&(BE="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),xh.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,BE,f));case 7:return xh.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,y))}})},gP_=function(p,a){a.length!==
0&&a.forEach(function(l){l=zn(l);
l.retryScheduleIndex<3&&Ak8(p.L,[l])})},YO_=function(){Ny.apply(this,arguments)},fnU=function(p,a,l){var y=eyU(a);
return qO7(p,y).then(function(){return Jk2(p,a,l)})},ilB=function(p,a){var l,y,S,n,V,z,d,G,B,c;
return g.R(function(r){switch(r.L){case 1:return l=g.Lf(),g.u(r,dS(),2);case 2:y=r.S;if(!y){r.g7(3);break}return g.u(r,pV8(y),4);case 4:S=r.S;case 3:var w=S;n={context:g.Ha(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:p},offlineClientState:w,clientStateRequestData:{preferredFormatType:a}}}};V=g.ax(ai8);g.$r(r,5);d={kY:!0};return g.u(r,g.JV(l,n,V,void 0,d),7);case 7:z=r.S;g.L8(r,6);break;case 5:G=g.L6(r);if(G instanceof g.eg)throw B=
"DPS network manager error for smart downloads: "+G.message,Dy(B,G),Error(B);Dy("DPS fetch request error for smart downloads",G);throw Error("DPS fetch request error for smart downloads");case 6:c=Gn(z);if(z)c!==void 0&&BC(c,"smart downloads");else throw Dy("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return r.return(z)}})},liM=function(){Ny.apply(this,arguments)},yNb=function(){Ny.apply(this,arguments)},SZW=function(){gL.apply(this,arguments)},
Y6=function(p){p.K&&p.G&&p.W&&p.visibility.isBackground()?g.sb(p.j,6E4):p.j.stop()},nv1=function(p){return p instanceof Error?new nS("UNKNOWN_ENCODE_ERROR",{originalMessage:p.message}):new nS("UNKNOWN_ENCODE_ERROR")},V0b=function(){Ny.apply(this,arguments)},ZNb=function(p){var a;
return g.R(function(l){if(l.L==1)return g.u(l,pV8(p),2);a=l.S;g.mf("offlineStateSnapshot",a);g.lD(l)})},ovc=function(){Ny.apply(this,arguments)},zBc=function(p,a){this.L=p;
this.Y=a},d6G=function(){Ny.apply(this,arguments)},Gfb=function(p,a){return g.Aw(p.L.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(a)},function(l){return g.Qn.all([l.delete(),
qO7(p,l.cursor.primaryKey)]).then(function(){cC(p,l.cursor.primaryKey,a);return g.Lt(l)})})},Bf1=function(p){var a=new g.b7("und",new g.AQ("Default","und",!0));
a.captionTracks=p.captionTracks;return a},cNa=function(){Ny.apply(this,arguments)},rN_=function(p,a){p=g.t(p.observers);
for(var l=p.next();!l.done;l=p.next())l=l.value,l(a)},qO7=function(p,a){return p.L.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(a))},$6K=function(p,a){var l,y,S,n;
return g.R(function(V){if(V.L==1){l=a.clientPlaybackNonce;y={cpn:l,offlineSourceVisualElement:g.E8(a.Xu||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};a.S&&(y.videoFmt=Number(a.S.itag));a.j&&(y.audioFmt=Number(a.j.itag));if((S=wVM(a))&&a.videoId){var z=a.videoId;z=S!=="PPSV"?Promise.resolve(!1):p.L.oG(z);V=g.u(V,z,3)}else V=V.g7(2);return V}V.L!=2&&(n=V.S)&&(y.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");p.S=l;g.mf("offlinePlaybackStarted",y);g.lD(V)})},tS=function(p,
a,l){return rS(p,{mode:"readonly",
Gn:!0},function(y){return wS(y,a,l)})},Pil=function(){Ny.apply(this,arguments)},LPM=function(){Ny.apply(this,arguments)},XVl=function(){Ny.apply(this,arguments)},x6W=function(){Ny.apply(this,arguments)},Cia=function(p,a){a:{p=FPM(p.S,a.version);
try{var l=p.S(a.data,a.key);break a}catch(y){Ev2(y,jJM)}l=void 0}return l},vvB=function(){Ny.apply(this,arguments)},KPW=function(p){var a,l;
return g.R(function(y){if(y.L==1)return g.u(y,g.Nb(),2);if(y.L!=3)return(a=y.S)?g.u(y,g.Fl(a),3):y.return();l=y.S;return y.return(g.Nk(l,["index","media","captions"],{mode:"readwrite",Gn:!0},function(S){var n=IDBKeyRange.bound(p+"|",p+"~");S=[S.objectStore("index").delete(n),S.objectStore("media").delete(n),S.objectStore("captions").delete(n)];return g.Qn.all(S).then(function(){})}))})},eBc=function(p){return p!==void 0},bNb=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Gn=function(p){var a;
return(a=p.errorMetadata)==null?void 0:a.status},$f=function(p,a,l){var y=eyU(a),S=FPM(p.S,1),n=Object.assign({},a);
return p.L.objectStore("EntityStore").get(y).then(function(V){if(V){if(V.entityType!==l)throw Error("Incorrect entity type");n.entityMetadata||(V=Cia(p,V),n.entityMetadata=V.entityMetadata)}}).then(function(){var V={key:y,
entityType:l,data:Iia(S,n,y),version:1};return g.Qn.all([g.U8(p.L.objectStore("EntityStore"),V),fnU(p,n,l)])}).then(function(){cC(p,y,l);
return y})},RBa=function(p,a){var l=p.L.objectStore("EntityAssociationStore");
return l.index("byParentEntityKey").getAll(IDBKeyRange.only(a)).then(function(y){var S=[];y=g.t(y);for(var n=y.next();!n.done;n=y.next())n=n.value,S.push(l.index("byChildEntityKey").getAll(n.childEntityKey));return g.Qn.all(S)}).then(function(y){var S=[];
y=g.t(y);for(var n=y.next();!n.done;n=y.next())n=n.value,n.length===1&&S.push(n[0].childEntityKey);return S})},Jfa=function(p){var a,l,y,S,n,V,z,d;
return g.R(function(G){switch(G.L){case 1:return a=g.Lf(),l=unb(p),y=g.ax(ONb),g.$r(G,2),n={kY:!0},g.u(G,g.JV(a,l,y,void 0,n),4);case 4:S=G.S;g.L8(G,3);break;case 2:V=g.L6(G);if(V instanceof g.eg)throw z="GetOffline network manager error: "+V.message,Dy(z,V),Error(z);Dy("GetOffline fetch request error",V);throw Error("GetOffline fetch request error");case 3:d=Gn(S);if(!S)throw Dy("Network request failed"),Error("Network request failed");if(d!==void 0)BC(d);else if(!S.videos||!S.videos.length)throw Dy("No data"),
Error("No data");return G.return(S.videos.map(function(B){return B.offlineVideoData}))}})},dS=function(){kfW||(kfW=M0l());
return kfW},m6W=function(){Ny.apply(this,arguments)},j81=function(p){return t0c[p.transferState]!==void 0},WP2=function(p,a){var l,y,S,n,V;
return g.R(function(z){if(z.L==1)return l=g.m8(a,"offlineVideoStreams"),g.u(z,tS(p,l,"offlineVideoStreams"),2);y=z.S;if(!y||!y.streamsProgress)return z.return();S=g.t(y.streamsProgress);for(n=S.next();!n.done;n=S.next())V=n.value,V.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",V.numTotalBytes!==V.numBytesDownloaded&&(V.numBytesDownloaded=V.numTotalBytes);return g.u(z,PC(p,y,"offlineVideoStreams"),0)})},LS=function(p,a){g.D.call(this);
this.token=p;this.L=a;this.observers=[];p=new g.dD.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Bi());p.onmessage=this.S.bind(this);this.channel=p},HNM=function(p){QS({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},p)},Xs7=function(p,a,l){a=a.map(function(y){return $f(p,y,l)});
return g.Qn.all(a)},Vf=function(p){this.token=p},D6_=function(){Ny.apply(this,arguments)},XQ=function(p){var a;
p.offlineDeleteReason=(a=p.offlineDeleteReason)!=null?a:"OFFLINE_DELETE_REASON_UNKNOWN";var l;p.offlineModeType=(l=p.offlineModeType)!=null?l:"OFFLINE_NOW";g.mf("offlineDeleteEvent",p)},hBc=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh,OM,q7,u_,i_,p8,G5,km,Kc,lF,eb,C,ar,e_,qQ,jb,Qo,pc,yB,U7,K,x,e,k,Q,or,U,J,M,e$,PM,Ze,za,hZ,KA,aO,vM,WM,bF,CF,uF,M7,b_;
return g.R(function(z5){switch(z5.L){case 1:return l=My(a),y=a.entityKey,S=g.xj(y).entityId,n=[],V=!1,S==="!*$_ALL_ENTITIES_!*$"?(V=!0,g.u(z5,mi(p.L,"mainPlaylistEntity"),5)):g.u(z5,tS(p.L,y,"mainPlaylistEntity"),4);case 4:(z=z5.S)&&n.push(z);z5.g7(3);break;case 5:n=z5.S;case 3:if((d=n)==null||!d.length)return z5.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));G=g.T(a.actionMetadata,iN_);c=(B=G)==null?void 0:B.nextAutoRefreshIntervalSeconds;w=(r=G)==null?void 0:r.autoSync;P=[];v=F=
!0;I=!1;if(!V&&w===!1){z5.g7(6);break}g.$r(z5,7);return g.u(z5,Tf2(0,!!w,!0,n),9);case 9:P=z5.S;g.L8(z5,8);break;case 7:b=g.L6(z5);if(!(b instanceof Error&&b.message==="No data")){b instanceof Error&&b.message==="Empty response body"&&Dy(b.message);z5.g7(8);break}return S==="!*$_ALL_ENTITIES_!*$"?g.u(z5,NfB(p.L,a,p.U,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.u(z5,s8G(S,p.L,a,p.U),8);case 8:if(!P.length||!V&&P[0].playlistId!==S)return z5.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l));case 6:if(V){O=[];m=g.t(P);for(H=m.next();!H.done;H=m.next())Y=H.value,Y.upToDate||w&&!Y.shouldAutoSyncMetadata||!Y.playlistId||(N={nextAutoRefreshIntervalSeconds:Y.checkInSeconds,autoSync:w},O.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Y.playlistId,"mainPlaylistEntity",0,xf,{mainPlaylistEntityActionMetadata:N})));return z5.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,O))}P.length&&(yo=P[0],I=!!yo.upToDate,w&&(F=(zq=yo.shouldAutoSyncMetadata)!=null?zq:!0,v=(S$=yo.shouldAutoSyncVideos)!=
null?S$:!0,yo.checkInSeconds&&(c=yo.checkInSeconds)));if(I||!F)return z5.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));BE=[];f=n[0];if(!f.downloadState){xh=void 0;z5.g7(15);break}return g.u(z5,tS(p.L,f.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:xh=z5.S;case 15:return Nf=xh,yU=((nc=Nf)==null?0:nc.addedTimestampMillis)?String(Nf.addedTimestampMillis):void 0,g.$r(z5,17),g.u(z5,U62(p,S,yU,c),19);case 19:BE=z5.S;g.L8(z5,18);break;case 17:kh=g.L6(z5);if(!(kh instanceof
Error&&kh.message==="No data for playlist")){if(kh instanceof Error&&kh.message==="Empty response body for playlist")Dy(kh.message);else return OM="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q7="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",kh instanceof g.ka&&kh.type==="QUOTA_EXCEEDED"&&(OM="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q7="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),z5.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,OM,q7));
z5.g7(18);break}return g.u(z5,s8G(S,p.L,a,p.U),18);case 18:if(!v)return z5.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));u_=[];i_=new Map;if((p8=BE)==null?0:p8.length)for(G5=g.t(BE),km=G5.next();!km.done;km=G5.next())Kc=km.value,lF=Kc.offlineVideoData,eb=void 0,((eb=lF)==null?0:eb.videoId)&&i_.set(lF.videoId,lF);C=new Map;ar=[];if((e_=f)==null?0:(qQ=e_.videos)==null?0:qQ.length)for(jb=g.t(f.videos),Qo=jb.next();!Qo.done;Qo=jb.next())if(pc=Qo.value,yB=JSON.parse(g.xj(pc).entityId),
U7=yB.videoId)i_.has(U7)?(C.set(U7,i_.get(U7)),i_.delete(U7)):ar.push(U7);x=Number(((K=a.actionMetadata)==null?void 0:K.priority)||0)+1;e=g.t(i_.entries());for(k=e.next();!k.done;k=e.next())Q=k.value,or=g.t(Q),U=or.next().value,J=or.next().value,M=U,e$=J,u_.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M,"mainVideoEntity",x,xf,Q8_(a,e$,S)));PM=g.t(C.entries());for(Ze=PM.next();!Ze.done;Ze=PM.next())za=Ze.value,hZ=g.t(za),KA=hZ.next().value,aO=hZ.next().value,vM=KA,WM=aO,u_.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
vM,"mainVideoEntity",x,xf,Q8_(a,WM,S)));bF=g.t(ar);for(CF=bF.next();!CF.done;CF=bF.next())uF=CF.value,M7={playlistId:S},b_={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:M7},u_.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",uF,"mainVideoEntity",0,xf,b_));return z5.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,u_))}})},kXM=function(){AN2||(AN2=new gvW);
return AN2},FQ=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!p.entityKey},qZc=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b;
return g.R(function(O){switch(O.L){case 1:return l=My(a),y=g.xj(a.entityKey),S=y.entityId,n=[],g.$r(O,2),g.u(O,U62(p,S),4);case 4:n=O.S;if(!(p.Y.D("woffle_enable_main_downloads_library")&&((V=n)==null?0:V.length))){O.g7(5);break}return g.u(O,U$b(p.L,[a.entityKey]),5);case 5:g.L8(O,3);break;case 2:return z=g.L6(O),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.ka&&z.type==="QUOTA_EXCEEDED"?(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Dy("Playlist add error"),O.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,d,G));case 3:B=[];if(!p.Y.D("html5_offline_prevent_redownload_downloaded_video")){O.g7(7);break}return g.u(O,YZl(p.L,"mainVideoEntity",n),8);case 8:n=O.S;case 7:if((c=n)==null?0:c.length)for(r=g.t(n),w=r.next();!w.done;w=r.next())if(P=w.value,F=P.offlineVideoData,v=void 0,(v=F)==null?0:v.videoId)I=void 0,b=Number(((I=a.actionMetadata)==null?void 0:I.priority)||
0)+1,B.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F.videoId,"mainVideoEntity",b,xf,Q8_(a,F,S)));return O.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,B))}})},JN_=function(){Ny.apply(this,arguments)},fi_=function(){Ny.apply(this,arguments)},p38=function(){Ny.apply(this,arguments)},aq1=function(){Ny.apply(this,arguments)},lqc=function(p){return new nS("WRONG_DATA_TYPE",{VJ:p})},EN=function(){},yX8=function(){Ny.apply(this,arguments)},U$b=function(p,a){var l;
return g.R(function(y){return y.L==1?g.u(y,SU2(p,a),2):(l=y.S)?g.u(y,rS(p,{mode:"readwrite",Gn:!0},function(S){var n=[$f(S,l.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];l.mainDownloadsListEntity&&n.push($f(S,l.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Qn.all(n)}),0):y.g7(0)})},nW1=function(){Ny.apply(this,arguments)},Vt7=function(p){var a,l,y,S;
g.R(function(n){switch(n.L){case 1:if(!p.L){JS(p,"onTransferPausedByUser");n.g7(2);break}a=p.L;p.j.stop();return g.u(n,pS(p,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:y=((l=a)==null?0:l.key)?g.xj(a.key).entityId:"";if(!y||!p.U){n.g7(4);break}return g.u(n,CS(y,p.U,p.S,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.u(n,UJ(p,y),6);case 6:S=n.S,HNM({videoId:y,F_:a,offlineModeType:S});case 2:vC(p),KS(p),g.lD(n)}})},ZIM=function(p,a,l){var y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m;
return g.R(function(H){y=[];S=new Set;if((n=l)==null?0:(V=n.downloadedTracks)==null?0:V.length)for(z=g.t(l.downloadedTracks),d=z.next();!d.done;d=z.next())G=d.value,S.add(G);if(p.tracks){B=g.t(p.tracks);for(c=B.next();!c.done;c=B.next())r=c.value,S.has(r)||y.push(r);w=g.t(a);for(P=w.next();!P.done;P=w.next())if(F=P.value,F.id!==p.id&&(v=F.tracks))for(I=g.t(v),b=I.next();!b.done;b=I.next())O=b.value,m=y.indexOf(O),m!==-1&&y.splice(m,1)}return H.return(y)})},Ev2=function(p,a){p=p instanceof nS?p:a(p);
g.iO(p);throw p;},oW1=function(){Ny.apply(this,arguments)},zPb=function(p){return g.R(function(a){g.Uy(p,0);
return a.return(KPW(p))})},nS=function(p,a){a=a===void 0?{}:a;
g.kc.call(this,g.ZoK[p],Object.assign({},{name:"PESEncoderError",type:p},a));this.type=p;this.level="WARNING";Object.setPrototypeOf(this,nS.prototype)},dx7=function(p){return g.R(function(a){p.api.xv("onOrchestrationBecameLeader");
return g.u(a,p.QD(),0)})},GYl=function(p,a){this.L=p;
this.S=a;this.U={}},Bpc=function(p){var a=g.FL();
a=Object.assign({},a);p=Object.assign({},p);for(var l in a)p[l]?(a[l]!==4&&(a[l]=p[l]),delete p[l]):a[l]!==2&&(a[l]=4);Object.assign(a,p);g.wS$(a);JSON.stringify(a);return a},gHc=function(p,a){var l,y,S;
return g.R(function(n){switch(n.L){case 1:return g.$r(n,2),(l=!!a.captionTracks.length||!!a.Ae)?g.u(n,cX2(a.videoId),4):n.return();case 4:return(y=n.S)?n.return():g.u(n,rX2(p.Kz,a),5);case 5:g.L8(n,0);break;case 2:S=g.L6(n),Dy("Caption downloading error",S,a.cotn),g.lD(n)}})},U62=function(p,a,l,y){var S,n,V,z,d,G,B;
return g.R(function(c){switch(c.L){case 1:return g.u(c,w37([a]),2);case 2:return S=c.S,g.u(c,$xK(p,S[0],l,y),3);case 3:return n=c.S,V=n.mainPlaylistEntity,z=n.kOO,G=PEc(V,(d=z)==null?void 0:d.avatar),g.$r(c,4),g.u(c,AS(G),6);case 6:g.L8(c,5);break;case 4:B=g.L6(c),B instanceof Error&&B.message==="Failed to fetch"&&Dy(B.message);case 5:return c.return(S[0].videos)}})},sJK=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v;
return g.R(function(I){if(I.L==1)return l=g.m8("main_downloads_library_id","mainDownloadsLibraryEntity"),y=g.m8("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.u(I,rS(p,{mode:"readonly",Gn:!0},function(b){return g.Qn.all([wS(b,l,"mainDownloadsLibraryEntity"),wS(b,y,"mainDownloadsListEntity"),wS(b,g.M2,"mainDownloadsListEntity")])}),2);
S=I.S;n=g.t(S);V=n.next().value;z=n.next().value;d=n.next().value;G=V;B=z;c=d;if(!G)return I.g7(0);if(a===g.M2&&((r=c)==null?0:r.downloads))c.downloads=[];else if((w=B)==null?0:w.downloads)for(P=g.xj(a).entityType,F=0;F<B.downloads.length;F++)if(v=B.downloads[F],P==="mainVideoEntity"&&v.videoItem===a){B.downloads.splice(F,1);break}else if(P==="mainPlaylistEntity"&&v.playlistItem===a){B.downloads.splice(F,1);break}return g.u(I,rS(p,{mode:"readwrite",Gn:!0},function(b){var O=[$f(b,G,"mainDownloadsLibraryEntity")];
B&&O.push($f(b,B,"mainDownloadsListEntity"));c&&O.push($f(b,c,"mainDownloadsListEntity"));return g.Qn.all(O)}),0)})},xxU=function(p){var a;
return g.R(function(l){return l.L==1?g.u(l,dS(),2):(a=l.S)?g.u(l,rS(a,"readwrite",function(y){for(var S={},n=g.t(p),V=n.next(),z={};!V.done;z={I1:void 0,Wb:void 0},V=n.next())z.I1=V.value,z.I1.entityKey&&LyB(z.I1)&&(z.Wb=g.Xl(z.I1.payload),V=void 0,z.I1.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(V=function(d){return function(){return $f(y,d.I1.payload[d.Wb],d.Wb)}}(z)),z.I1.type==="ENTITY_MUTATION_TYPE_DELETE"&&(V=function(d){return function(){return e7(y,d.I1.entityKey)}}(z)),z.I1.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(V=function(d){return function(){return X3c(y,d.I1.entityKey,d.I1.payload[d.Wb],d.Wb)}}(z)),V&&(S[z.I1.entityKey]=S[z.I1.entityKey]?S[z.I1.entityKey].then(V):V()));
return g.Qn.all(Object.values(S))}),0):l.return()})},FyK=function(p){QS({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},p)},EWM=function(){be.apply(this,arguments);
this.Sl="mainVideoEntity"},CE8=function(p){return new g.BG(function(a,l){var y=p.length,S=[];
if(y)for(var n=function(G,B){y--;S[G]=B;y==0&&a(S)},V=function(G){l(G)},z,d=0;d<p.length;d++)z=p[d],g.V2F(z,g.CP(n,d),V);
else a(S)})},cC=function(p,a,l){var y=p.U[l];
y||(y=new Set,p.U[l]=y);y.add(a)},vWl=function(){Ny.apply(this,arguments)},KyG=function(){Ny.apply(this,arguments)},Jk2=function(p,a,l){var y=eyU(a);
l=eP7(l);if(!l)return g.Qn.resolve([]);l=new l(a);p=p.L.objectStore("EntityAssociationStore");a=[];l=g.t(l.S());for(var S=l.next();!S.done;S=l.next())a.push(g.U8(p,{parentEntityKey:y,childEntityKey:S.value}));return g.Qn.all(a).then(function(n){return n.map(function(V){return V[1]})})},bIb=function(p,a){var l;
return g.R(function(y){if(y.L==1)return g.u(y,mi(p.S,"offlineOrchestrationActionWrapperEntity",a),2);l=y.S;return y.return(l.filter(eBc))})},IqU=function(){Ny.apply(this,arguments)},RPB=function(){gL.apply(this,arguments)},uNa=function(p){var a,l,y;
g.R(function(S){if(S.L==1){if(!p.L)return JS(p,"onTransferPausedByNetwork"),S.return();p.j.stop();return g.u(S,pS(p,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(S.L!=3)return a=p.L,(y=((l=a)==null?0:l.key)?g.xj(a.key).entityId:"")&&p.U?g.u(S,CS(y,p.U,p.S,"DOWNLOAD_STATE_PAUSED"),3):S.g7(3);vC(p);g.lD(S)})},o3=function(p,a,l,y,S){var n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh,OM,q7;
return g.R(function(u_){switch(u_.L){case 1:return n=g.m8(p,"mainVideoEntity"),V=g.m8(p,"ytMainChannelEntity"),z=g.m8(p,"transfer"),d=g.m8(p,"videoDownloadContextEntity"),g.u(u_,rS(a,{mode:"readonly",Gn:!0},function(i_){return g.Qn.all([wS(i_,n,"mainVideoEntity"),wS(i_,V,"ytMainChannelEntity"),wS(i_,z,"transfer"),wS(i_,d,"videoDownloadContextEntity"),fQ(i_,"ytMainChannelEntity"),fQ(i_,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:G=u_.S;B=g.t(G);c=B.next().value;r=B.next().value;w=B.next().value;P=B.next().value;F=B.next().value;v=B.next().value;I=c;b=r;O=w;m=P;H=F;Y=v;if(!I&&!b){u_.g7(3);break}N=I?hS(I.thumbnail):[];if(!b){yo=[];u_.g7(4);break}return g.u(u_,OIU(b,H),5);case 5:yo=u_.S;case 4:return zq=yo,g.u(u_,I3(N.concat(zq)),3);case 3:S$=[];BE=g.m8(p,"downloadStatusEntity");f=g.t(Y);for(xh=f.next();!xh.done;xh=f.next())Nf=xh.value,nc=g.xj(Nf.key).entityId,yU=zn(Nf),kh=g.xj(yU.action.entityKey).entityId,nc!==p&&kh!==
p||S7(l,Nf.actionProto)||S$.push(Nf.key);return g.u(u_,rS(a,{mode:"readwrite",Gn:!0},function(i_){var p8=S$.map(function(G5){return e7(i_,G5)});
p8.push(e7(i_,n,{WA:!0}));p8.push(e7(i_,BE,{WA:!0}));return g.Qn.all(p8)}),7);
case 7:q7=(OM=m)==null?void 0:OM.offlineModeType,S&&(XQ(S),S.offlineModeType&&(q7=S.offlineModeType)),R3(O,q7),sJ(y,{entityKey:n,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.lD(u_)}})},kYU=function(p,a,l){var y=this;
this.Z=p;this.Sl=a;this.visibility=l;this.W=this.K=this.G=this.U=this.L=!1;this.j=new g.l_(function(){y.TX()});
this.hg={k6:function(){return y.S},
TX:function(){y.TX()},
utv:function(){return y.j}};
this.visibility.subscribe("visibilitystatechange",function(){y.JN()})},ue=function(p,a,l,y,S,n,V,z,d,G,B){this.entityType=p;
this.actionId=a;this.action=l;this.parentActionId=y;this.rootActionId=S===void 0?a:S;this.childActionIds=n;this.prereqActionId=V;this.postreqActionIds=z;this.hasChildActionFailed=G;this.retryScheduleIndex=0;this.L=B||Date.now();this.retryScheduleIndex=d||0},Mtl=function(p,a){p.L&&(p.G=a,Y6(p))},mxU=function(p){var a=[],l=p.videos;
l&&l.length>0&&a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:l[0].offlineVideoData.thumbnail}}});if((p=p.additionalMetadadatas)&&p.length>0)for(p=g.t(p),l=p.next();!l.done;l=p.next()){var y=l.value.offlineBundleItemPlaylistData,S=void 0;l=(S=y)==null?void 0:S.style;S=void 0;y={collageThumbnail:{coverThumbnail:(S=y)==null?void 0:S.coverThumbnail}};switch(l){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:y});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:y});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:y});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:y})}}return a},OIU=function(p,a){var l,y,S,n,V,z,d,G;
return g.R(function(B){l=hS(p.avatar);y=g.t(a);for(S=y.next();!S.done;S=y.next())if(n=S.value,n.id!==p.id)for(V=g.t(hS(n.avatar)),z=V.next();!z.done;z=V.next())d=z.value,G=l.indexOf(d),G!==-1&&l.splice(G,1);return B.return(l)})},ttW=function(p,a,l,y,S){var n;
return g.R(function(V){return V.L==1?(S||(S=Date.now().toString()),n={id:g.m8(l,"musicTrackDownloadMetadataEntity"),playbackData:g.m8(l,"playbackData"),addedTimestampMillis:S,videoDownloadContextEntity:g.m8(l,"videoDownloadContextEntity")},y&&(a.albumRelease=y.id),g.u(V,rS(p.L,{mode:"readwrite",Gn:!0},function(z){var d=[],G=$f(z,n,"musicTrackDownloadMetadataEntity");d.push(G);G=$f(z,a,"musicTrack");d.push(G);y&&(z=$f(z,y,"musicAlbumRelease"),d.push(z));return g.Qn.all(d)}),2)):V.L!=3?g.u(V,CS(l,"musicTrackDownloadMetadataEntity",
p.L,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):V.return({musicTrackEntity:a,
zb:y})})},zn=function(p){if(!p.key)throw Error("Entity key is required.");
if(!p.actionProto)throw Error("OfflineOrchestrationAction is required.");var a=g.xj(p.key),l=g.xj(p.actionProto.entityKey);return new ue(l.entityType,a.entityId,p.actionProto,p.parentActionId,p.rootActionId,p.childActionIds,p.prereqActionId,p.postreqActionIds,p.retryScheduleIndex,p.hasChildActionFailed,Number(p.enqueueTimeSec)*1E3)},jYl=function(){Ny.apply(this,arguments)},Ck_=function(p){this.Tm=p;
this.L=void 0},HIc=function(p,a,l,y){var S,n,V;
return g.R(function(z){switch(z.L){case 1:return g.u(z,w37([a]),2);case 2:return S=z.S,g.u(z,WyU(p,S[0],l,y),3);case 3:return n=z.S,V=hS(n.thumbnailDetails),g.u(z,AS(V),4);case 4:return z.return(S[0].videos)}})},iIc=function(p,a){if(a.length===0)return Promise.resolve([]);
a=a.map(function(l){return ON(l)});
return Dxc(p.S,a)},Tpa=function(p,a){var l,y,S,n,V,z,d,G;
return g.R(function(B){l=hS(p.thumbnailDetails);y=g.t(a);for(S=y.next();!S.done;S=y.next())if(n=S.value,n.id!==p.id)for(V=g.t(hS(n.thumbnailDetails)),z=V.next();!z.done;z=V.next())d=z.value,G=l.indexOf(d),G!==-1&&l.splice(G,1);return B.return(l)})},U8M=function(p,a,l,y){y={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!y};a&&l&&(a=Math.floor(a/1024).toFixed(),l=Math.floor(l/1024).toFixed(),y.alreadyDownloadedKbytes=a,y.totalFetchedKbytes=a,y.totalContentKbytes=l);QS(y,p)},NpU=function(p){QS({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},p)},sYb=function(){Ny.apply(this,arguments)},UxU=function(){Ny.apply(this,arguments)},LyB=function(p){var a;
p=(a=p.options)==null?void 0:a.persistenceOption;return p==="ENTITY_PERSISTENCE_OPTION_PERSIST"||p==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},QY8=function(){Ny.apply(this,arguments)},hPU=function(){Ny.apply(this,arguments)},AX_=function(){Ny.apply(this,arguments)},kf=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!p.entityKey},gWc=function(p,a){p.L&&(p.K=a,Y6(p))},qU_=function(p,a){var l,y;
return g.R(function(S){switch(S.L){case 1:return l=My(a),g.u(S,tS(p.L,a.entityKey,"transfer"),2);case 2:y=S.S;if(!y||y.transferState!=="TRANSFER_STATE_COMPLETE")return S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.$r(S,3);return g.u(S,YUU(p,a,!0),5);case 5:g.L8(S,4);break;case 3:return g.L6(S),S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},yUa=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq;
return g.R(function(S$){switch(S$.L){case 1:return l=a.entityKey,y=g.xj(l).entityId,g.u(S$,rS(p.L,{mode:"readonly",Gn:!0},function(BE){var f=wS(BE,l,"playbackData"),xh=wS(BE,g.m8(y,"offlineVideoPolicy"),"offlineVideoPolicy");BE=wS(BE,g.m8(y,"transfer"),"transfer");return g.Qn.all([f,xh,BE])}),2);
case 2:S=S$.S;n=g.t(S);V=n.next().value;z=n.next().value;d=n.next().value;G=V;B=z;c=d;if(!G||!B)return S$.return(Mq(a,!0));r=[];F=((P=G)==null?0:P.playerResponseJson)?JSON.parse(G.playerResponseJson):null;if(!(c&&F&&p.Y.D("html5_refresh_deprecated_downloads"))){S$.g7(3);break}w=JXc(p,F,c);return g.u(S$,fqW(p,c),4);case 4:r=S$.S;case 3:v={lastPlayerResponseTimestampSeconds:G.playerResponseTimestamp,offlineToken:B.offlineToken,formatIds:r};I={};if((b=c)==null?0:b.maximumDownloadQuality)I.maximumDownloadQuality=
c.maximumDownloadQuality;g.$r(S$,5);O=void 0;return g.u(S$,pQU(p,a),7);case 7:return O=S$.S,g.$r(S$,8),g.u(S$,aT1(l,p.Y,{refreshData:v,XA:I,offlineSourceData:O,mediaCapabilities:w}),10);case 10:m=S$.S;g.L8(S$,9,5);break;case 8:return g.L6(S$,5),H=My(a)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Dy("PDE handleRefresh error"),S$.return(Mq(a,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",H,"DOWNLOAD_STATE_FAILED"));
case 9:return g.u(S$,lTU(p,m,a),11);case 11:return S$.return(Mq(a,!0,m.orchestrationActions));case 5:return Y=g.L6(S$),N="PDE handleRefresh error",Y instanceof Error&&(N="PDE handleRefresh error: "+Y.message),yo="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",zq="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.ka&&Y.type==="QUOTA_EXCEEDED"&&(yo="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",zq="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Dy(N),S$.return(Mq(a,
!1,void 0,yo,zq,"DOWNLOAD_STATE_FAILED"))}})},ON=function(p){return{key:g.m8(p.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:p.action,parentActionId:p.parentActionId,rootActionId:p.rootActionId,childActionIds:p.childActionIds,prereqActionId:p.prereqActionId,postreqActionIds:p.postreqActionIds,retryScheduleIndex:p.retryScheduleIndex,hasChildActionFailed:p.hasChildActionFailed,enqueueTimeSec:(p.L/1E3).toFixed()}},EP2=function(p,a){this.api=p;
this.L=a;this.logger=new g.iF("woffle");this.S=!1;this.hg={VW:this.VW}},S3l=function(){Ny.apply(this,arguments)},Z$B=function(p){var a,l,y,S,n,V,z,d;
return g.R(function(G){switch(G.L){case 1:return a=g.Lf(),l=nq8(p),y=g.ax(VZB),g.$r(G,2),n={kY:!0},g.u(G,g.JV(a,l,y,void 0,n),4);case 4:S=G.S;g.L8(G,3);break;case 2:V=g.L6(G);if(V instanceof g.eg)throw z="offlinePlaylistSyncCheck network manager error: "+V.message,Dy(z,V),Error(z);Dy("offlinePlaylistSyncCheck fetch request error",V);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:d=Gn(S);if(!S)throw Dy("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(d!==void 0)BC(d,"playlist sync");else if(!S.offlinePlaylistSyncCheckDatas||!S.offlinePlaylistSyncCheckDatas.length)throw Dy("No data for playlist sync"),Error("No data for playlist sync");return G.return(S.offlinePlaylistSyncCheckDatas.map(function(B){return B.offlinePlaylistSyncCheckData}))}})},be=function(p,a){var l=this;
this.Y=p;this.api=a;this.G=new g.RA;this.W=new g.rQ;this.hg={k6:function(){return l.U.hg.k6()},
n5:function(){return l.G},
Qtm:function(){return l.U},
Sw:function(){return l.Sw()},
QD:function(){return l.QD()},
Hg:function(){return l.Hg()},
rF:function(){return l.rF()},
t_:function(){return l.t_()},
s7:function(y){return l.s7(y)}};
this.U=new kYU(function(){return dx7(l)},function(){l.Hg()},this.api.TM(),this.api.D.bind(this.api));
this.L=new ti(this.api);oql(this.U)},z_c=function(p,a){var l,y;
return g.R(function(S){if(S.L==1)return g.u(S,g.Nb(),2);if(S.L!=3){l=S.S;if(!l)throw g.K6("wct");return g.u(S,g.Fl(l),3)}y=S.S;return g.u(S,g.Nk(y,["captions"],{mode:"readwrite",Gn:!0},function(n){var V=[];n=n.objectStore("captions");for(var z=0;z<a.length;z++){var d=g.U8(n,a[z],p+"|"+a[z].metadata.vss_id);V.push(d)}return g.Qn.all(V)}),0)})},djG=function(p,a,l){this.L=p;
this.Y=a;this.U=l},cUa=function(p,a,l,y){y=y===void 0?!1:y;
var S,n,V,z,d,G,B,c,r,w,P,F,v,I,b;return g.R(function(O){switch(O.L){case 1:return S=[],g.u(O,GAc(),2);case 2:return(n=O.S)||y?g.u(O,BbK(a,l),3):O.return([]);case 3:V=O.S;if((z=V)==null||!z.length)return O.return([]);d={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};G=g.t(V);B=G.next();case 4:if(B.done){O.g7(6);break}r=c=B.value;w=r.actionType;P=r.entityKey;F=r.actionMetadata;if(!(w&&P&&F)||g.T(F,QJW)){O.g7(5);break}w==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(F.offlineLoggingData=
d);v=g.xj(P);I=v.entityId;return g.u(O,j7(p,[I],"mainVideoEntity",w,F),8);case 8:b=O.S,S=S.concat(b);case 5:B=G.next();O.g7(4);break;case 6:return O.return(S)}})},wQG=function(p,a){var l,y,S,n,V,z,d,G;
return g.R(function(B){switch(B.L){case 1:return l=g.Lf(),y={context:g.Ha(),videoPlaybackPositionEntities:p,lastSyncTimestampUsec:a},S=g.ax(rU_),g.$r(B,2),V={kY:!0},g.u(B,g.JV(l,y,S,void 0,V),4);case 4:n=B.S;g.L8(B,3);break;case 2:z=g.L6(B);if(z instanceof g.eg)throw d="VPPS network manager error: "+z.message,Dy(d,z),Error(d);Dy("VPPS fetch request error",z);throw Error("VPPS fetch request error");case 3:G=Gn(n);if(n)G!==void 0&&BC(G,"position sync");else throw Dy("Network request failed for position sync"),
Error("Network request failed for position sync");return B.return(n)}})},$jM=function(){this.locks=navigator.locks},PC=function(p,a,l){return rS(p,{mode:"readwrite",
Gn:!0},function(y){return $f(y,a,l)})},Pv8=function(){Ny.apply(this,arguments)},Lx7=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I;
return g.R(function(b){switch(b.L){case 1:return l=My(a),y=g.xj(a.entityKey),S=y.entityId,n=[],g.$r(b,2),g.u(b,m8c(p,S),4);case 4:n=b.S;if((V=n)==null||!V.length){b.g7(5);break}return g.u(b,BQW(p.L,a.entityKey),5);case 5:g.L8(b,3);break;case 2:return z=g.L6(b),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.ka&&z.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
b.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,d,G));case 3:return B=[],g.u(b,YZl(p.L,"musicTrack",n),7);case 7:n=b.S;if(n.length)for(c=g.t(n),r=c.next();!r.done;r=c.next())if(w=r.value,P=w.offlineVideoData,F=void 0,(F=P)==null?0:F.videoId)v=void 0,I=Number(((v=a.actionMetadata)==null?void 0:v.priority)||0)+1,B.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P.videoId,"musicTrack",I,Hm,Ty(a,P,S)));return b.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,B))}})},
XQ_=function(){Ny.apply(this,arguments)},mi=function(p,a,l){return rS(p,{mode:"readonly",
Gn:!0},function(y){return fQ(y,a,l)})},WyU=function(p,a,l,y){var S,n,V,z,d,G,B,c,r;
return g.R(function(w){return w.L==1?(S=a.playlistId,n=je_(a),V=n.uR,z=n.td,d=l?(Number(l)*1E3).toString():Date.now().toString(),G=a.lastModifiedTimestamp?(Number(a.lastModifiedTimestamp)*1E3).toString():"0",B={id:g.m8(S,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:z,lastModifiedTimestampMillis:G,addedTimestampMillis:d,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},c={id:g.m8(S,"musicPlaylist"),title:a.title,playlistId:S,thumbnailDetails:a.thumbnail,visibility:x$M(a),trackCount:a.totalVideoCount,
tracks:V,downloadMetadata:B.id},y&&(((r=c)==null?0:r.entityMetadata)?c.entityMetadata.nextAutoRefreshIntervalSeconds=String(y):c&&(c.entityMetadata={nextAutoRefreshIntervalSeconds:String(y)})),g.u(w,rS(p.L,{mode:"readwrite",Gn:!0},function(P){var F=$f(P,c,"musicPlaylist");P=$f(P,B,"musicPlaylistDownloadMetadataEntity");return g.Qn.all([F,P])}),2)):w.return(c)})},xjU=function(){Ny.apply(this,arguments)},WC=function(p,a,l,y,S){var n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo;
return g.R(function(zq){switch(zq.L){case 1:return n=g.m8(p,"musicTrack"),V=g.m8(p,"transfer"),g.u(zq,rS(a,{mode:"readonly",Gn:!0},function(S$){return g.Qn.all([wS(S$,n,"musicTrack"),wS(S$,V,"transfer"),fQ(S$,"musicTrack"),fQ(S$,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:z=zq.S;d=g.t(z);G=d.next().value;B=d.next().value;c=d.next().value;r=d.next().value;w=G;P=B;F=c;v=r;if(!w){zq.g7(3);break}return g.u(zq,Tpa(w,F),4);case 4:return I=zq.S,g.u(zq,I3(I),3);case 3:b=[];O=g.t(v);for(m=O.next();!m.done;m=O.next())H=m.value,Y=g.xj(H.key).entityId,N=zn(H),yo=g.xj(N.action.entityKey).entityId,Y!==p&&yo!==p||S7(l,H.actionProto)||b.push(H.key);return g.u(zq,rS(a,{mode:"readwrite",Gn:!0},function(S$){var BE=b.map(function(f){return e7(S$,f)});
BE.push(e7(S$,n,{WA:!0}));return g.Qn.all(BE)}),6);
case 6:R3(P),S&&XQ(S),sJ(y,{entityKey:n,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.lD(zq)}})},Fxl=function(p){return g.R(function(a){if(a.L==1)return p.W?g.u(a,le(p.K,p.W.videoDetails.videoId),3):a.g7(0);
vC(p);g.lD(a)})},HC=function(p){this.L=p},pV8=function(p){var a,l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh,OM,q7,u_,i_,p8,G5,km;
return g.R(function(Kc){if(Kc.L==1)return g.u(Kc,rS(p,{mode:"readonly",Gn:!0},function(lF){return fQ(lF,"playbackData").then(function(eb){var C=eb.map(function(jb){return jb.transfer}).filter(function(jb){return!!jb}),ar=eb.map(function(jb){return jb.offlineVideoPolicy}).filter(function(jb){return!!jb}),e_=eb.filter(function(jb){return!!jb.key}).map(function(jb){return g.m8(g.xj(jb.key).entityId,"downloadStatusEntity")});
C=fQ(lF,"transfer",C);ar=fQ(lF,"offlineVideoPolicy",ar);e_=fQ(lF,"downloadStatusEntity",e_);var qQ=C.then(function(jb){jb=jb.reduce(function(Qo,pc){(pc==null?0:pc.offlineVideoStreams)&&Qo.push.apply(Qo,g.u0(pc.offlineVideoStreams));return Qo},[]).filter(function(Qo){return!!Qo});
return fQ(lF,"offlineVideoStreams",jb)});
return g.Qn.all([C,ar,qQ,e_]).then(function(jb){var Qo=g.t(jb);jb=Qo.next().value;var pc=Qo.next().value;var yB=Qo.next().value;Qo=Qo.next().value;return[eb,jb,pc,yB,Qo]})})}),2);
if(Kc.L!=3)return a=Kc.S,g.u(Kc,rS(p,{mode:"readonly",Gn:!0},function(lF){return fQ(lF,"mainDownloadsListEntity").then(function(eb){var C,ar;return(ar=(C=eb[0])==null?void 0:C.downloads)!=null?ar:[]})}),3);
l=Kc.S;y=g.t(a);S=y.next().value;n=y.next().value;V=y.next().value;z=y.next().value;d=y.next().value;G=S;B=n;c=V;r=z;w=d;P={};F={};v={};I={};b={};O=[];m=g.t(B);for(H=m.next();!H.done;H=m.next())(Y=H.value)&&(P[Y.key]=Y);N=g.t(c);for(yo=N.next();!yo.done;yo=N.next())(zq=yo.value)&&(F[zq.key]=zq);S$=g.t(w);for(BE=S$.next();!BE.done;BE=S$.next())(f=BE.value)&&(v[f.key]=f);xh=g.t(r);for(Nf=xh.next();!Nf.done;Nf=xh.next())(nc=Nf.value)&&(I[nc.key]=nc);yU=g.t(l);for(kh=yU.next();!kh.done;kh=yU.next())OM=
kh.value,q7=void 0,b[(q7=OM.videoItem)!=null?q7:""]=!0,OM.videoItem&&(i_=u_=void 0,p8=(i_=(u_=g.xj(OM.videoItem))==null?void 0:u_.entityId)!=null?i_:"",O.push({externalVideoId:p8}));G5=G.filter(function(lF){if(!lF||!lF.key||!lF.offlineVideoPolicy)return!1;lF=g.xj(lF.key).entityId;lF=g.m8(lF,"downloadStatusEntity");var eb;return!(lF&&((eb=v[lF])==null?void 0:eb.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
km=G5.map(function(lF){var eb=P[lF.transfer],C=[];if(eb==null?0:eb.offlineVideoStreams)for(var ar=g.t(eb.offlineVideoStreams),e_=ar.next();!e_.done;e_=ar.next())(e_=I[e_.value])&&C.push(e_);ar=F[lF.offlineVideoPolicy];e_=b;var qQ=lF==null?void 0:lF.playerResponseTimestamp,jb=g.xj(ar.key).entityId;lF=g.m8(jb,"mainVideoEntity");if(ar.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Qo="OFFLINE_VIDEO_STATE_DISABLED";ar.expirationTimestamp&&Number(ar.expirationTimestamp)<Date.now()/1E3&&(Qo="OFFLINE_VIDEO_STATE_EXPIRED")}else if(ar.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Qo="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(eb==null?void 0:eb.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Qo="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Qo="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Qo="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Qo="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Qo="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Qo="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Qo="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Qo==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(eb==null?void 0:eb.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Qo="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Qo="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Qo=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}jb={id:jb,videoState:Qo};if(eb==null?0:eb.cotn)jb.cotn=eb.cotn;if(eb==null?0:eb.maximumDownloadQuality)jb.selectedVideoQuality=eb==null?void 0:eb.maximumDownloadQuality;if(eb==null?0:eb.lastProgressTimeMs)jb.lastProgressTimeMs=eb.lastProgressTimeMs;qQ&&(jb.playerResponseSavedTimeMs=String(Number(qQ)*1E3));eb=String;qQ=0;C=g.t(C);for(Qo=C.next();!Qo.done;Qo=C.next())if(Qo=Qo.value,Qo.streamsProgress){Qo=g.t(Qo.streamsProgress);for(var pc=Qo.next();!pc.done;pc=Qo.next()){var yB=
void 0;qQ+=Number((yB=pc.value.numBytesDownloaded)!=null?yB:0)}}jb.downloadedBytes=eb(qQ);jb.selectedOfflineMode=e_[lF]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";ar.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(jb.offlinePlaybackDisabledReason=ar.offlinePlaybackDisabledReason);return jb});
return Kc.return({offlineVideos:km,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:O}}})})},EqK=function(){Ny.apply(this,arguments)},Cv_=function(){if(DZ)return DZ();
var p={};DZ=g.k$("PersistentEntityStoreDb",{LN:(p.EntityStore={gp:1},p.EntityAssociationStore={gp:2},p),shared:!1,upgrade:function(a,l){l(1)&&g.OD(g.WY(a,"EntityStore",{keyPath:"key"}),"entityType","entityType");l(2)&&(a=g.WY(a,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.OD(a,"byParentEntityKey","parentEntityKey"),g.OD(a,"byChildEntityKey","childEntityKey"))},
version:3});return DZ()},vqc=function(p,a){return{id:p,
channelId:a.channelId,title:a.title,avatar:a.thumbnail}},Kxb=function(p,a){var l,y,S;
return g.R(function(n){l=g.t(a);for(y=l.next();!y.done;y=l.next()){S=y.value;var V=void 0,z=void 0,d=((z=S.action)==null?void 0:(V=z.actionMetadata)==null?void 0:V.retryScheduleIntervalsInSeconds)||[1,2,4];V=1;S.retryScheduleIndex<d.length&&(V=d[S.retryScheduleIndex]);S.L=V*1E3+Date.now();S.retryScheduleIndex++}return g.u(n,iIc(p,a),0)})},nq8=function(p){return{context:g.Ha(),
offlinePlaylistSyncChecks:p}},e_W=function(){Ny.apply(this,arguments)},b$2=function(p,a){this.L=p;
this.U=a},Tf2=function(p,a,l,y){var S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh;
return g.R(function(OM){switch(OM.L){case 1:return g.u(OM,dS(),2);case 2:S=OM.S;if(!S)return OM.return([]);n=[];if((V=y)==null?0:V.length){n=y;OM.g7(3);break}return g.u(OM,mi(S,"mainPlaylistEntity"),4);case 4:n=OM.S;case 3:if(!n.length)return OM.return([]);z=[];d=Date.now()/1E3;G=g.t(n);B=G.next();case 5:if(B.done)return z.length?g.u(OM,Z$B(z),10):OM.return([]);c=B.value;if(!c.downloadState){r=void 0;OM.g7(8);break}return g.u(OM,tS(S,c.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:r=
OM.S;case 8:w=r;P=void 0;v=(F=(P=c)==null?void 0:P.entityMetadata)&&F.nextAutoRefreshIntervalSeconds?Number(F.nextAutoRefreshIntervalSeconds):NaN;I=Number.isNaN(v)?p:v;O=b=void 0;m=((b=w)==null?0:b.lastSyncedTimestampMillis)?Number((O=w)==null?void 0:O.lastSyncedTimestampMillis)/1E3:0;Y=H=void 0;N=((H=w)==null?0:H.addedTimestampMillis)?Number((Y=w)==null?void 0:Y.addedTimestampMillis)/1E3:0;if(l||!F||m+I<=d){yo=[];zq=void 0;if((zq=c.videos)==null?0:zq.length)for(S$=g.t(c.videos),BE=S$.next();!BE.done;BE=
S$.next())f=BE.value,xh=JSON.parse(g.xj(f).entityId),xh.videoId&&yo.push(xh.videoId);Nf="0";F&&(nc=void 0,Nf=String(Number((nc=F.offlineLastModifiedTimestampSeconds)!=null?nc:0).toFixed()));yU={playlistId:c.playlistId,videoIds:yo,offlineLastModifiedTimestamp:Nf,autoSync:a,offlineDateAddedTimestamp:String(N.toFixed())};z.push(yU)}B=G.next();OM.g7(5);break;case 10:return kh=OM.S,OM.return(kh)}})},PEc=function(p,a){var l=[];
if(p.thumbnailStyleData){p=g.t(p.thumbnailStyleData);for(var y=p.next();!y.done;y=p.next()){var S=void 0,n=void 0,V=void 0;l=l.concat(hS((S=y.value)==null?void 0:(n=S.value)==null?void 0:(V=n.collageThumbnail)==null?void 0:V.coverThumbnail))}}a=hS(a);return l.concat(a)},ITc=function(){Ny.apply(this,arguments)},R_8=function(p,a,l){this.L=p;
this.Y=a;this.U=l},uXa=function(){Ny.apply(this,arguments)},O$7=function(p){return{context:g.Ha(),
playlistIds:p}},kAG=function(){Ny.apply(this,arguments)},MZl=function(p){return g.bx((0,g.Vlb)(),p)},mjc=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b;
return g.R(function(O){switch(O.L){case 1:return l=My(a),y=g.xj(a.entityKey),S=y.entityId,g.u(O,tS(p.L,a.entityKey,"mainVideoEntity"),2);case 2:n=O.S;if(!n){V=void 0;O.g7(3);break}return g.u(O,tS(p.L,n.downloadState,"mainVideoDownloadStateEntity"),4);case 4:V=O.S;case 3:z=V;if(!n||!z)return O.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.$r(O,5);return g.u(O,psG(p,S,z.addedTimestampMillis,(G=g.T(a.actionMetadata,qy))==null?void 0:G.offlineVideoData),7);case 7:B=1;B=Number(((c=
a.actionMetadata)==null?void 0:c.priority)||0)+1;d=Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",S,"playbackData",B,Pk2);g.L8(O,6);break;case 5:r=g.L6(O);if(!(r instanceof Error&&r.message==="No data")){if(r instanceof Error&&r.message==="Empty response body")Dy(r.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.ka&&r.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),O.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,w,P));O.g7(6);break}return g.u(O,ZZ(p.L,S),9);case 9:F=O.S;v=g.T(a.actionMetadata,qy);if(b=(I=v)==null?void 0:I.playlistId)F.playlistId=b;F.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.u(O,o3(S,p.L,a,p.U,F),6);case 6:return O.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,d?[d]:void 0))}})},a3=function(p,a,l,y){l=l===void 0?!1:l;
y=y===void 0?!0:y;a=typeof a==="string"?a:a.videoDetails.videoId;if(g.xY(a)===2){var S=tZ8(p,a);S&&S.stopVideo();g.Uy(a,2);p.U=2;l?Vt7(p.L):y&&uNa(p.L)}},BbK=function(p,a){var l,y,S;
return g.R(function(n){switch(n.L){case 1:return g.$r(n,2),g.u(n,ilB(p,a),4);case 4:return y=n.S,g.u(n,TQ8(y),5);case 5:l=NQB(y);g.L8(n,3);break;case 2:S=g.L6(n),Dy("getAndProcessSmartDownloadsResponse request or processing error",S);case 3:return n.return(l)}})},jKl=function(){Ny.apply(this,arguments)},WxK=function(){gL.apply(this,arguments)},ie=function(){be.apply(this,arguments);
this.Sl="musicTrack"},Tn=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!p.entityKey},hwW=function(p,a){var l,y,S,n,V;
return g.R(function(z){if(z.L==1)return l=g.xj(a.key),y=l.entityId,S=g.m8(y,"playbackData"),g.u(z,tS(p.S,S,"playbackData"),2);n=z.S;if((V=n)==null?0:V.playerResponseJson)return z.return(JSON.parse(n.playerResponseJson));throw Error("No PlayerResponse found");})},Dxc=function(p,a){return rS(p,{mode:"readwrite",
Gn:!0},function(l){return Xs7(l,a,"offlineOrchestrationActionWrapperEntity")})},H$K=function(p,a){this.L=p;
this.U=a},i$c=function(){var p;
return g.R(function(a){return a.L==1?g.u(a,Dj1(),2):(p=a.S)?a.return(p.delete("yt-player-local-img")):a.return(!0)})},Tb7=function(){Ny.apply(this,arguments)},UjW=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh,OM,q7,u_,i_,p8,G5,km,Kc,lF,eb,C,ar,e_,qQ,jb,Qo,pc,yB,U7,K,x,e,k,Q,or,U,J,M,e$,PM,Ze,za,hZ,KA,aO,vM,WM,bF,CF;
return g.R(function(uF){switch(uF.L){case 1:return l=My(a),y=a.entityKey,S=g.xj(y).entityId,n=[],V=!1,S==="!*$_ALL_ENTITIES_!*$"?(V=!0,g.u(uF,mi(p.L,"musicPlaylist"),5)):g.u(uF,tS(p.L,y,"musicPlaylist"),4);case 4:(z=uF.S)&&n.push(z);uF.g7(3);break;case 5:n=uF.S;case 3:if((d=n)==null||!d.length)return uF.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));G=g.T(a.actionMetadata,Nba);c=(B=G)==null?void 0:B.autoSync;r=[];P=w=!0;F=!1;v=void 0;if(!V&&c===!1){uF.g7(6);break}g.$r(uF,7);return g.u(uF,
sKB(0,!!c,!0,n),9);case 9:r=uF.S;g.L8(uF,8);break;case 7:I=g.L6(uF);if(!(I instanceof Error&&I.message==="No data")){I instanceof Error&&I.message==="Empty response body"&&Dy(I.message);uF.g7(8);break}return S==="!*$_ALL_ENTITIES_!*$"?g.u(uF,Nq(p.L,a,p.U),8):g.u(uF,iA(S,"musicPlaylist",p.L,a,p.U),8);case 8:if(!r.length||!V&&r[0].playlistId!==S)return uF.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));case 6:if(V){b=[];O=g.t(r);for(m=O.next();!m.done;m=O.next())H=m.value,H.upToDate||
c&&!H.shouldAutoSyncMetadata||!H.playlistId||(Y={autoSync:c},b.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H.playlistId,"musicPlaylist",0,sN,{musicPlaylistEntityActionMetadata:Y})));return uF.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,b))}r.length&&(N=r[0],F=!!N.upToDate,c&&(w=(yo=N.shouldAutoSyncMetadata)!=null?yo:!0,P=(zq=N.shouldAutoSyncVideos)!=null?zq:!0,N.checkInSeconds&&(v=N.checkInSeconds)));if(F||!w)return uF.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l));S$=[];BE=n[0];f=void 0;if(!BE.downloadMetadata){uF.g7(15);break}return g.u(uF,tS(p.L,BE.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:xh=uF.S,f=Number((nc=(Nf=xh)==null?void 0:Nf.addedTimestampMillis)!=null?nc:"0")/1E3;case 15:return g.$r(uF,17),g.u(uF,HIc(p,S,(yU=f)==null?void 0:yU.toString(),v),19);case 19:S$=uF.S;g.L8(uF,18);break;case 17:kh=g.L6(uF);if(!(kh instanceof Error&&kh.message==="No data")){if(kh instanceof Error&&kh.message==="Empty response body")Dy(kh.message);
else return OM="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q7="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",kh instanceof g.ka&&kh.type==="QUOTA_EXCEEDED"&&(OM="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q7="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),uF.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,OM,q7));uF.g7(18);break}return g.u(uF,iA(S,"musicPlaylist",p.L,a,p.U),18);case 18:if(!P)return uF.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l));u_=[];i_=new Map;if((p8=S$)==null?0:p8.length)for(G5=g.t(S$),km=G5.next();!km.done;km=G5.next())Kc=km.value,lF=Kc.offlineVideoData,eb=void 0,((eb=lF)==null?0:eb.videoId)&&i_.set(lF.videoId,lF);C=new Map;ar=[];if((e_=BE)==null?0:(qQ=e_.tracks)==null?0:qQ.length)for(jb=g.t(BE.tracks),Qo=jb.next();!Qo.done;Qo=jb.next())if(pc=Qo.value,yB=g.xj(pc).entityId)i_.has(yB)?(C.set(yB,i_.get(yB)),i_.delete(yB)):ar.push(yB);K=Number(((U7=a.actionMetadata)==null?void 0:U7.priority)||0)+1;x=g.t(i_.entries());
for(e=x.next();!e.done;e=x.next())k=e.value,Q=g.t(k),or=Q.next().value,U=Q.next().value,J=or,M=U,u_.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"musicTrack",K,sN,Ty(a,M)));e$=g.t(C.entries());for(PM=e$.next();!PM.done;PM=e$.next())Ze=PM.value,za=g.t(Ze),hZ=za.next().value,KA=za.next().value,aO=hZ,vM=KA,u_.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",aO,"musicTrack",K,sN,Ty(a,vM)));WM=g.t(ar);for(bF=WM.next();!bF.done;bF=WM.next())CF=bF.value,u_.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
CF,"musicTrack",0,sN));return uF.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,u_))}})},h__=function(p){var a,l,y,S,n,V,z;
return g.R(function(d){if(d.L==1)return g.u(d,bIb(p),2);a=d.S;l=[];y=g.t(a);for(S=y.next();!S.done;S=y.next())n=S.value,V=g.xj(n.key),z=V.entityId,an7(p.L,z)||l.push(n);return g.u(d,QK_(p,l),0)})},aT1=function(p,a,l){var y,S,n,V,z,d,G,B;
return g.R(function(c){switch(c.L){case 1:y=g.Lf();var r=l.refreshData,w=l.isEnqueuedForExpiredStreamUrlRefetch,P=l.XA,F=l.offlineSourceData,v=l.mediaCapabilities,I={entityKey:p};r&&(I.refreshData=r);w&&(I.isExpiredStreamUrlRefetch=w);P&&(I.downloadParameters=P);F&&(I.offlineSourceData=F);r={context:g.J3Z(a),signatureTimestamp:20354,videos:[I]};v&&(r.mediaCapabilities=v);S=r;n=g.ax(AU1);g.$r(c,2);z={kY:!0};return g.u(c,g.JV(y,S,n,void 0,z),4);case 4:V=c.S;g.L8(c,3);break;case 2:d=g.L6(c);if(d instanceof
g.eg)throw G="GetPDE network manager error: "+d.message,Dy(G,d),Error(G);Dy("GetPDE fetch request error",d);throw Error("GetPDE fetch request error");case 3:B=Gn(V);if(V)B!==void 0&&BC(B,"PDE");else throw Dy("Network request failed for PDE"),Error("Network request failed for PDE");return c.return(V)}})},SU2=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O;
return g.R(function(m){if(m.L==1)return l=g.m8("main_downloads_library_id","mainDownloadsLibraryEntity"),y=g.m8("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.u(m,rS(p,{mode:"readonly",Gn:!0},function(H){return g.Qn.all([wS(H,l,"mainDownloadsLibraryEntity"),wS(H,y,"mainDownloadsListEntity")])}),2);
S=m.S;n=g.t(S);V=n.next().value;z=n.next().value;d=V;G=z;d||(d={id:l});B=g.t(a);for(c=B.next();!c.done;c=B.next())if(r=c.value,r===g.M2){if(d.smartDownloadsList)return m.return();d.smartDownloadsList=r}else if(w=g.xj(r).entityType,P={},w==="mainPlaylistEntity"?P.playlistItem=r:w==="mainVideoEntity"&&(P.videoItem=r),!g.cL(P)){F=void 0;if((F=G)==null?0:F.downloads){v=!1;I=g.t(G.downloads);for(b=I.next();!b.done;b=I.next())if(O=b.value,O.playlistItem===r||O.videoItem===r){v=!0;break}v||G.downloads.push(P)}else G=
{id:y,downloads:[P]};d.downloadsList=y}return m.return({mainDownloadsLibraryEntity:d,mainDownloadsListEntity:G})})},rX2=function(p,a){var l,y,S,n;
return g.R(function(V){l=a.videoId;y=!0;if(a.captionTracks.length)S=Bf1(a),p.L=new g.kT(p.Tm,a,S);else if(a.Ae)n=g.VYF(a),p.L=new g.aI(p.Tm,a.Ae,l,n,a.NJ,a.eventId),y=a.NJ;else return V.return();return V.return(new Promise(function(z){var d;(d=p.L)==null||d.lx({q0:function(){return g.R(function(G){if(G.L==1)return g.u(G,p.q0(l,y),2);z();g.lD(G)})},
Mt:function(){}})}))})},Afc=function(p,a,l){return new g.rO(p,{cotn:a,
raw_player_response:l,download_media:!0,start:Infinity,disable_watch_next:!0})},gqM=function(){},vC=function(p){p.L=void 0;
p.W=void 0;p.j.stop()},q3M=function(p){var a,l;
return g.R(function(y){if(y.L==1)return g.u(y,mi(p.S,"transfer"),2);a=y.S;l=a.filter(j81).sort(Y32);return l.length===0?y.return():y.return(l[0])})},fTc=function(p){var a,l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I;
return g.R(function(b){switch(b.L){case 1:if(p.j)throw Error("Already processing an action");if(p.Gm())return b.return();a=p.L.actions.shift();Mtl(p.UO,!a);if(a===void 0)return b.return();a.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&a.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&JU8(p.L,a.actionId);l="";a.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&a.rootActionId===a.actionId&&(l=a.actionId);y=[a];p.j=y;if(S=p.w7[a.entityType]){b.g7(2);break}p.j=
void 0;return g.u(b,fTc(p),3);case 3:return b.return();case 2:n=g.t(y);for(V=n.next();!V.done;V=n.next())z=V.value,p5W(z,2);g.$r(b,4,5);return g.u(b,a21(S,y.map(function(O){return O.action})),7);
case 7:d=b.S,G=g.t(y),B=G.next();case 8:if(B.done){b.g7(10);break}c=B.value;r=d.get(c.action);return g.u(b,l2U(p,c,r),9);case 9:B=G.next();b.g7(8);break;case 10:JU8(p.L,l);case 5:g.TK(b);p.j=void 0;g.$F(b,6);break;case 4:return w=g.L6(b),Dy("Orchestration error",w),g.$r(b,12),g.u(b,Kxb(p,y),14);case 14:g.L8(b,5);break;case 12:P=g.L6(b);Dy("Orchestration retry error",P);F=g.t(y);for(v=F.next();!v.done;v=F.next())I=v.value,I.retryScheduleIndex<3&&Ak8(p.L,[I]);b.g7(5);break;case 6:return g.u(b,fTc(p),
0)}})},yAl=function(p){var a=(p.L.transferRetryCount||0)<3;
a&&(p=p.L,p.transferRetryCount=(p.transferRetryCount||0)+1);return a},SiK=function(){Ny.apply(this,arguments)},FPM=function(p,a){a=a===void 0?0:a;
p=p.L[a];if(!p)throw a=new nS("INVALID_ENCODER_VERSION",{VJ:a}),g.iO(a),a;return p},cX2=function(p){var a;
return g.R(function(l){if(l.L==1)return g.u(l,n31(p),2);a=l.S;return l.return(!!a&&a.length>0)})},VPb=function(p,a,l){if(l.has(a))return g.Qn.resolve(void 0);
l.add(a);return RBa(p,a).then(function(y){return p.L.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(a)).then(function(){return y})}).then(function(y){var S=g.Qn.resolve(void 0);
y=g.t(y);for(var n=y.next(),V={};!n.done;V={nM:void 0},n=y.next())V.nM=n.value,S=S.then(function(z){return function(){return VPb(p,z.nM,l)}}(V));
return S}).then(function(){})},Zuc=function(p,a,l,y){var S,n,V,z,d,G,B,c;
return g.R(function(r){switch(r.L){case 1:S=[],n=g.t(a),V=n.next();case 2:if(V.done){r.g7(4);break}z=V.value;if(z.upToDate||l&&!z.shouldAutoSyncMetadata||!z.playlistId){r.g7(3);break}d={};switch(y){case "mainPlaylistEntity":G={nextAutoRefreshIntervalSeconds:z.checkInSeconds,autoSync:l};d={mainPlaylistEntityActionMetadata:G};break;case "musicPlaylist":B={autoSync:l},d={musicPlaylistEntityActionMetadata:B}}return g.u(r,j7(p,[z.playlistId],y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d),6);case 6:(c=
r.S)&&S.push.apply(S,g.u0(c));case 3:V=n.next();r.g7(2);break;case 4:return r.return(S)}})},o3a=function(){Ny.apply(this,arguments)},YUU=function(p,a,l){l=l===void 0?!1:l;
var y,S,n,V,z,d,G,B,c,r,w,P,F,v,I;return g.R(function(b){switch(b.L){case 1:return y=g.T(a.actionMetadata,zI7),S=g.xj(a.entityKey).entityId,n=g.m8(S,"downloadStatusEntity"),g.u(b,rS(p.L,{mode:"readonly",Gn:!0},function(O){var m=wS(O,n,"downloadStatusEntity");O=wS(O,g.m8(S,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Qn.all([m,O])}),2);
case 2:return V=b.S,z=g.t(V),d=z.next().value,G=z.next().value,B=d,c=G,r="TRANSFER_STATE_TRANSFER_IN_QUEUE",((w=B)==null?void 0:w.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(r="TRANSFER_STATE_PAUSED_BY_USER"),v={key:a.entityKey,transferState:r,cotn:g.VI(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(P=y)==null?void 0:P.maximumDownloadQuality,preferredAudioTrack:(F=y)==null?void 0:F.preferredAudioTrack,transferRetryCount:0,isRefresh:l,hasLoggedFirstStarted:!1},g.u(b,rS(p.L,
{mode:"readwrite",Gn:!0},function(O){var m=[];l&&m.push(e7(O,g.m8(S,"offlineVideoStreams")));m.push($f(O,v,"transfer"));return g.Qn.all(m)}),3);
case 3:if(!l){b.g7(4);break}return g.u(b,dE1(S),4);case 4:FyK({videoId:S,F_:v,offlineModeType:(I=c)==null?void 0:I.offlineModeType}),g.lD(b)}})},G9W=function(p,a,l){this.L=p;
this.Y=a;this.U=l},NfB=function(p,a,l,y){var S,n,V,z,d,G,B,c,r;
return g.R(function(w){if(w.L==1)return S=g.m8("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),n=new Map,g.u(w,rS(p,{mode:"readwrite",Gn:!0},function(P){var F=fQ(P,"transfer"),v=fQ(P,"offlineOrchestrationActionWrapperEntity"),I=fQ(P,"videoDownloadContextEntity"),b=wS(P,S,"mainDownloadsListEntity");return g.Qn.all([F,v,I,b]).then(function(O){O=g.t(O);var m=O.next().value;var H=O.next().value;var Y=O.next().value;var N=O.next().value;O=BhK.map(function(zq){return Gfb(P,zq)});
H=g.t(H);for(var yo=H.next();!yo.done;yo=H.next())yo=yo.value,S7(a,yo.actionProto)||O.push(e7(P,yo.key,{WA:!0}));N&&(N.downloads=[],O.push($f(P,N,"mainDownloadsListEntity")));if(Y)for(Y=g.t(Y),N=Y.next();!N.done;N=Y.next())N=N.value,H=g.xj(N.key).entityId,H=g.m8(H,"transfer"),n.set(H,N.offlineModeType);return g.Qn.all(O).then(function(){return m})})}),2);
V=w.S;z=g.t(V);for(d=z.next();!d.done;d=z.next())G=d.value,R3(G,n.get(G.key)),B=g.xj(G.key).entityId,c={videoId:B,offlineDeleteReason:y,cotn:G.cotn,offlineModeType:n.get(G.key)},XQ(c),r=g.m8(B,"mainVideoEntity"),sJ(l,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.u(w,i$c(),0)})},cAb=function(){Ny.apply(this,arguments)},rAa=function(p,a){var l,y,S,n;
return g.R(function(V){switch(V.L){case 1:return l=My(a),g.$r(V,2),y=g.xj(a.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.u(V,NfB(p.L,a,p.U,(S=a.actionMetadata)==null?void 0:(n=S.offlineLoggingData)==null?void 0:n.offlineDeleteReason),5):g.u(V,s8G(y,p.L,a,p.U),6);case 6:if(!p.Y.D("woffle_enable_main_downloads_library")){V.g7(5);break}return g.u(V,sJK(p.L,a.entityKey),5);case 5:g.L8(V,3);break;case 2:return g.L6(V),V.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},fQ=function(p,a,l){return l?(l=l.map(function(y){return wS(p,y,a)}),g.Qn.all(l)):p.L.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(a)).then(function(y){return y.map(function(S){return Cia(p,S)})})},PT_=function(p,a,l,y,S){var n;
return g.R(function(V){if(V.L==1)return n=new UN(p,a,l,y,S),g.u(V,w5c(n),2);$Ec(n);return V.return(n)})},fz2=function(p,a,l,y){var S,n,V,z,d,G,B,c,r,w,P,F,v;
return g.R(function(I){switch(I.L){case 1:l||(l=Date.now().toString());n=(S=a.channel)==null?void 0:S.offlineChannelData;V={id:g.m8(a.videoId,"ytMainChannelEntity"),channelId:n.channelId,title:n.title,avatar:n.thumbnail};z={key:g.m8(a.videoId,"mainVideoDownloadStateEntity"),playbackData:g.m8(a.videoId,"playbackData"),addedTimestampMillis:l,videoDownloadContextEntity:g.m8(a.videoId,"videoDownloadContextEntity")};d={key:g.m8(a.videoId,"videoPlaybackPositionEntity"),videoId:a.videoId,lastPlaybackPositionSeconds:"0"};
p.Y.D("html5_offline_playback_position_sync")&&(G={playbackPosition:d.key});B=g.m8(a.videoId,"mainVideoEntity");c={key:B,videoId:a.videoId,title:a.title,thumbnail:a.thumbnail,localizedStrings:{viewCount:a.shortViewCountText},userState:G,lengthSeconds:a.lengthSeconds?Number(a.lengthSeconds):void 0,publishedTimestampMillis:a.publishedTimestamp?(Number(a.publishedTimestamp)*1E3).toString():void 0,formattedDescription:a.description,owner:V.id,downloadState:z.key};if(!p.Y.D("woffle_enable_main_downloads_library")||
!y){I.g7(2);break}return g.u(I,SU2(p.L,[B]),3);case 3:if(P=I.S)r=P.mainDownloadsLibraryEntity,w=P.mainDownloadsListEntity;case 2:return v=LDM,F={key:g.m8(a.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.HD(z,v,F),g.u(I,rS(p.L,{mode:"readwrite",Gn:!0},function(b){var O=$f(b,V,"ytMainChannelEntity"),m=$f(b,z,"mainVideoDownloadStateEntity"),H=$f(b,c,"mainVideoEntity");O=[O,m,H];p.Y.D("html5_offline_playback_position_sync")&&(m=$f(b,d,"videoPlaybackPositionEntity"),
O.push(m));r&&(m=$f(b,r,"mainDownloadsLibraryEntity"),O.push(m));w&&(m=$f(b,w,"mainDownloadsListEntity"),O.push(m));F&&(b=$f(b,F,"downloadStatusEntity"),O.push(b));return g.Qn.all(O)}),4);
case 4:return I.return({mainVideoEntity:c,channelEntity:V})}})},X5K=function(){Ny.apply(this,arguments)},xEW=function(p,a,l){var y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq;
return g.R(function(S$){y=[];S=new Set;if(l.length)for(n=g.t(l),V=n.next();!V.done;V=n.next())if(z=V.value,d=void 0,(d=z.downloads)==null?0:d.length)for(G=g.t(z.downloads),B=G.next();!B.done;B=G.next())c=B.value,c.videoItem&&(r=g.xj(c.videoItem).entityId,S.add(r));if(p.videos){w=g.t(p.videos);for(P=w.next();!P.done;P=w.next())F=P.value,v=JSON.parse(g.xj(F).entityId),v.videoId&&!S.has(v.videoId)&&y.push(v.videoId);I=g.t(a);for(b=I.next();!b.done;b=I.next())if(O=b.value,O.key!==p.key&&(m=O.videos))for(H=
g.t(m),Y=H.next();!Y.done;Y=H.next())N=Y.value,yo=JSON.parse(g.xj(N).entityId),yo.videoId&&(zq=y.indexOf(yo.videoId),zq!==-1&&y.splice(zq,1))}return S$.return(y)})},$Ec=function(p){var a=p.L.actions[0];
return p.j?((a==null?void 0:a.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&p.j[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(p.W=!0),Promise.resolve()):fTc(p)},Ol8=function(p,a,l){if(!l){var y=y===void 0?!1:y;
l=p.L.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!l||y)l=g.VI(16),p.L.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",l)}p={flowNonce:l,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:a.eventType};a.metadata&&(p.flowMetadata=a.metadata);a.statusCode!==void 0&&(p.flowEventStatus=a.statusCode);a.csn&&(p.csn=a.csn);a.can&&(p.can=a.can);g.mf("flowEvent",p,void 0)},FDa=function(){this.actions=[]},Y32=function(p,a){var l=t0c[p.transferState],y=t0c[a.transferState];
return l!==y?l-y:Number(p.enqueuedTimestampMs)-Number(a.enqueuedTimestampMs)},E3c=function(p){if(p==null?0:p.streamsProgress){var a=0;
p=p.streamsProgress;for(var l=0;l<p.length;l++){var y=p[l];isNaN(Number(y.numBytesDownloaded))?Dy("stream progress bytes number invalid"):a+=Number(y.numBytesDownloaded)}return a}return 0},CTW=function(){},I3=function(p){var a,l;
return g.R(function(y){if(y.L==1)return g.u(y,Dj1(),2);if(y.L!=3){a=y.S;if(!a)throw Error("Cache API not supported");return p.length?g.u(y,a.open("yt-player-local-img"),3):y.return()}l=y.S;return g.u(y,Promise.all(p.map(function(S){return l.delete(S)})),0)})},ti=function(p){g.D.call(this);
var a=this;this.api=p;this.hg={YDs:function(){return a.L},
stT:function(){return a.S}};
typeof g.dD.BroadcastChannel!=="undefined"&&(this.L=new g.dD.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Bi()),this.L.onmessage=this.U.bind(this),this.S=new g.dD.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Bi()),this.S.onmessage=this.j.bind(this))},CS=function(p,a,l,y,S){S=S===void 0?!1:S;
var n,V,z,d,G,B;return g.R(function(c){if(c.L==1)return n=g.m8(p,a),V=g.m8(p,"downloadStatusEntity"),g.u(c,rS(l,{mode:"readonly",Gn:!0},function(r){return g.Qn.all([wS(r,n,a),wS(r,V,"downloadStatusEntity")])}),2);
z=c.S;d=z.length?z[0]:void 0;if(!d)return c.g7(0);G=LDM;if(B=z.length>1?z[1]:void 0){if(B.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!S)return c.return();B.downloadState=y}else B={key:V,downloadState:y};g.HD(d,G,B);return g.u(c,rS(l,{mode:"readwrite",Gn:!0},function(r){return g.Qn.all([$f(r,d,a),$f(r,B,"downloadStatusEntity")])}),0)})},wVM=function(p){var a;
p=g.T((a=p.getWatchNextResponse())==null?void 0:a.currentVideoEndpoint,g.SK);if(p==null?0:p.playlistId)var l=p.playlistId;return l},yf=function(p){g.D.call(this);
this.L=p;this.S=this.L.observe(this.U.bind(this))},j7=function(p,a,l,y,S){var n,V,z;
return g.R(function(d){if(d.L==1)return g.u(d,dS(),2);n=d.S;if(!n)return d.return([]);V=a.map(function(G){var B=g.m8(G,l);B={actionType:y,entityKey:B,actionMetadata:Object.assign({},v3B(),S)};y!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(B.actionMetadata.priority=0);G=new ue(l,G,B);return ON(G)});
z=Dxc(n,V);oql(p.U);return d.return(z)})},KDl=function(p){for(var a,l=g.t(p.additionalMetadatas),y=l.next();!y.done;y=l.next())y=y.value,y.offlineMusicVideoData&&(a=y.offlineMusicVideoData);
var S,n,V,z,d;return{id:g.m8(p.videoId,"musicTrack"),videoId:p.videoId,title:p.title,thumbnailDetails:p.thumbnail,lengthMs:String(Number(p.lengthSeconds)*1E3),albumTitle:(S=a)==null?void 0:S.releaseTitle,musicVideoType:(n=a)==null?void 0:n.musicVideoType,contentRating:{explicitType:(V=a)==null?void 0:V.explicitType},artistNames:((z=a)==null?void 0:z.byline)||((d=a)==null?void 0:d.channelName),downloadMetadata:g.m8(p.videoId,"musicTrackDownloadMetadataEntity")}},eIc=function(){Ny.apply(this,arguments)},
buU=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v;
return g.R(function(I){switch(I.L){case 1:return l=My(a),y=g.xj(a.entityKey),S=y.entityId,g.u(I,tS(p.L,a.entityKey,"musicTrack"),2);case 2:n=I.S;if(!n){V=void 0;I.g7(3);break}return g.u(I,tS(p.L,n.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:V=I.S;case 3:z=V;if(!n||!z)return I.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));G=g.T(a.actionMetadata,d$c);g.$r(I,5);return g.u(I,GXb(p,S,z.addedTimestampMillis,(B=G)==null?void 0:B.track,(c=G)==null?void 0:c.albumRelease),
7);case 7:w=Number(((r=a.actionMetadata)==null?void 0:r.priority)||0)+1;d=Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",S,"playbackData",w,ckU);g.L8(I,6);break;case 5:P=g.L6(I);if(!(P instanceof Error&&P.message==="No data")){if(P instanceof Error&&P.message==="Empty response body")Dy(P.message);else return F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.ka&&P.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),I.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,F,v));I.g7(6);break}return g.u(I,WC(S,p.L,a,p.U),6);case 6:return I.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,d?[d]:void 0))}})},YZl=function(p,a,l){l=l===void 0?[]:l;
var y,S,n,V,z,d,G,B,c,r,w,P,F;return g.R(function(v){if(v.L==1)return l.length?g.u(v,mi(p,a),2):v.return([]);y=v.S;S=new Set;n=g.t(y);for(V=n.next();!V.done;V=n.next())if(z=V.value,d=z.id||z.key)G=g.xj(d).entityId,S.add(G);B=[];c=g.t(l);for(r=c.next();!r.done;r=c.next())w=r.value,P=w.offlineVideoData,F=void 0,((F=P)==null?0:F.videoId)&&!S.has(P.videoId)&&B.push(w);return v.return(B)})},w37=function(p){var a,l,y,S,n,V,z,d;
return g.R(function(G){switch(G.L){case 1:return a=g.Lf(),l=O$7(p),y=g.ax(ONb),g.$r(G,2),n={kY:!0},g.u(G,g.JV(a,l,y,void 0,n),4);case 4:S=G.S;g.L8(G,3);break;case 2:V=g.L6(G);if(V instanceof g.eg)throw z="GetOffline network manager error for playlist: "+V.message,Dy(z,V),Error(z);Dy("GetOffline fetch request error for playlist",V);throw Error("GetOffline fetch request error for playlist");case 3:d=Gn(S);if(!S)throw Dy("Network request failed for playlist"),Error("Network request failed for playlist");
if(d!==void 0)BC(d,"playlist");else if(!S.playlists||!S.playlists.length)throw Dy("No data for playlist"),Error("No data for playlist");return G.return(S.playlists.map(function(B){return B.offlinePlaylistData}))}})},I2M=function(){gL.apply(this,arguments)},fqW=function(p,a){var l,y,S,n,V,z,d,G,B,c,r;
return g.R(function(w){if(w.L==1)return l=[],g.u(w,rS(p.L,{mode:"readonly",Gn:!0},function(P){var F=[],v=a.offlineVideoStreams;if(v){v=g.t(v);for(var I=v.next();!I.done;I=v.next())F.push(wS(P,I.value,"offlineVideoStreams"))}return g.Qn.all(F)}),2);
if(y=w.S)for(S=g.t(y),n=S.next();!n.done;n=S.next())if(V=n.value,z=void 0,(z=V)==null?0:z.streamsProgress)for(d=V.streamsProgress,G=0;G<d.length;G++)B=d[G],c=JSON.parse(B.formatStreamBytes),r={itag:c.itag,lmt:c.lastModified,xtags:c.xtags},l.push(r);return w.return(l)})},RI8=function(){Ny.apply(this,arguments)},uSc=function(p){var a;
return g.R(function(l){switch(l.L){case 1:if(!p.S)return Dy("transferManager is undefined"),l.return();if(p.S.L){l.g7(2);break}return g.u(l,KS(p.S),2);case 2:if(!p.Y.D("woffle_enable_main_downloads_library")){l.g7(4);break}return g.u(l,p.vK(),4);case 4:if(!p.Y.D("html5_offline_playback_position_sync")){l.g7(6);break}return g.u(l,p.z7(),7);case 7:return g.u(l,p.s7(864E5),6);case 6:return g.u(l,p.refreshAllStaleEntities(43200,!0),9);case 9:return g.u(l,p.n2(),10);case 10:if(!p.Y.D("html5_retry_downloads_for_expiration")){l.g7(11);
break}return g.u(l,p.t_(),11);case 11:return p.Z=g.Vo(function(){p.refreshAllStaleEntities(43200,!0);p.n2()},9E5),g.jv(g.W4(),function(){return p.rF()}),g.u(l,dS(),13);
case 13:return a=l.S,g.u(l,ZNb(a),14);case 14:wsB(p.U),g.lD(l)}})},JXc=function(p,a,l){a=Afc(p.Y,l.cotn,a);
l=g.Vw(a);return g.ZAK(a,l,p.Y)},iA=function(p,a,l,y,S){var n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh,OM,q7,u_,i_,p8,G5,km;
return g.R(function(Kc){switch(Kc.L){case 1:return n=g.m8(p,a),V=g.m8("music_downloads_library_id","musicDownloadsLibraryEntity"),g.u(Kc,rS(l,{mode:"readonly",Gn:!0},function(lF){return g.Qn.all([wS(lF,n,a),wS(lF,V,"musicDownloadsLibraryEntity"),fQ(lF,a),fQ(lF,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:z=Kc.S;d=g.t(z);G=d.next().value;B=d.next().value;c=d.next().value;r=d.next().value;w=G;P=B;F=c;v=r;if(!w){Kc.g7(3);break}return g.u(Kc,Tpa(w,F),4);case 4:return I=Kc.S,g.u(Kc,I3(I),3);case 3:b=[];O=new Map;if(!w){Kc.g7(6);break}return g.u(Kc,ZIM(w,F,P),7);case 7:b=Kc.S;m=g.t(b);for(H=m.next();!H.done;H=m.next())Y=H.value,N=g.xj(Y).entityId,O.set(N,{videoId:N,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.u(Kc,mi(l,"transfer"),8);case 8:for(yo=Kc.S,zq=
g.t(yo),S$=zq.next();!S$.done;S$=zq.next())BE=S$.value,f=g.xj(BE.key).entityId,(xh=O.get(f))&&BE&&(xh.cotn=BE.cotn);case 6:Nf=[];nc=g.t(v);for(yU=nc.next();!yU.done;yU=nc.next())kh=yU.value,OM=g.xj(kh.key).entityId,q7=zn(kh),OM!==p&&q7.rootActionId!==p||S7(y,kh.actionProto)||Nf.push(kh.key);u_=g.m8(p,a);return g.u(Kc,rS(l,{mode:"readwrite",Gn:!0},function(lF){var eb=Nf.map(function(C){return e7(lF,C)});
eb.push(e7(lF,u_,{WA:!0}));return g.Qn.all(eb)}),9);
case 9:if(!w){Kc.g7(0);break}b.reverse();if(!b.length){Kc.g7(0);break}i_=g.t(b);p8=i_.next();case 12:if(p8.done){Kc.g7(0);break}G5=p8.value;km=g.xj(G5).entityId;if(!km){Kc.g7(13);break}return g.u(Kc,WC(km,l,y,S,O.get(km)),13);case 13:p8=i_.next(),Kc.g7(12)}})},OuG=function(p){switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
k9B=function(p,a){var l,y;
return g.R(function(S){switch(S.L){case 1:return l=My(a),g.u(S,tS(p.L,a.entityKey,"transfer"),2);case 2:if(y=S.S)return S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.$r(S,3);return g.u(S,YUU(p,a),5);case 5:g.L8(S,4);break;case 3:return g.L6(S),S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},MPW=function(p,a,l){a=a===void 0?43200:a;
l=l===void 0?!0:l;var y=y===void 0?!1:y;var S,n;return g.R(function(V){switch(V.L){case 1:if(!p.G.Dd())return V.return([]);S=[];g.$r(V,2);return g.u(V,sKB(a,l,y),4);case 4:S=V.S;g.L8(V,3);break;case 2:g.L6(V);case 3:return n=Zuc(p,S,l,"musicPlaylist"),V.return(n)}})},mEW=function(){return g.R(function(p){if(Qf!==void 0)return p.return(Qf);
Qf=new Promise(function(a){var l;return g.R(function(y){switch(y.L){case 1:return g.$r(y,2),g.u(y,hi.open("test-only"),4);case 4:return g.u(y,hi.delete("test-only"),5);case 5:g.L8(y,3);break;case 2:if(l=g.L6(y),l instanceof Error&&l.name==="SecurityError")return a(!1),y.return();case 3:a("caches"in window),g.lD(y)}})});
return p.return(Qf)})},tPb=function(){Ny.apply(this,arguments)},p5W=function(p,a){var l={offlineOrchestrationContext:RyB(p)};
a=u4a(a,l);Ol8(kXM(),a,p.rootActionId)},BC=function(p,a){a=a?" for "+a:"";
if(p===0)throw p="Empty response body"+a,Dy(p),Error(p);p="Response with error"+a;Dy(p);throw Error(p);},jU=function(p,a,l,y,S,n){this.status=p;
this.L=a;this.j=l;this.S=y;this.U=S;this.downloadState=n},Ai=function(){},rS=function(p,a,l){var y,S,n,V;
return g.R(function(z){if(z.L==1)return g.u(z,jqM(p.token),2);if(z.L!=3)return y=z.S,g.u(z,g.Nk(y,["EntityStore","EntityAssociationStore"],a,function(d){S=new GYl(d,p.L);return l(S)}),3);
n=z.S;S&&(V=S.U,Object.keys(V).length>0&&(p.channel.postMessage(V),rN_(p,V)));return z.return(n)})},gvW=function(){this.L=new Map},Mq=function(p,a,l,y,S,n){return new jU(a?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",My(p),l,y,S,n)},WD2=function(){Ny.apply(this,arguments)},TQ8=function(p){var a;
return g.R(function(l){a=g.T(p.frameworkUpdates,gS);return p.frameworkUpdates&&a?g.u(l,Hua(a),0):l.return()})},Ty=function(p,a,l){a={track:KDl(a)};
l&&(a.playlistId=l);if(p=g.T(p.actionMetadata,Nba))a.maximumDownloadQuality=p.maximumDownloadQuality;return{musicTrackEntityActionMetadata:a}},GXb=function(p,a,l,y,S){var n,V,z,d,G,B;
return g.R(function(c){switch(c.L){case 1:if(n=y){c.g7(2);break}return g.u(c,Jfa([a]),3);case 3:V=c.S,z=V[0],n=KDl(z);case 2:return g.u(c,ttW(p,n,a,S,l),4);case 4:d=c.S;G=d.musicTrackEntity;B=d.zb;var r=hS(G.thumbnailDetails),w=[];B&&(w=hS(B.thumbnailDetails));return g.u(c,AS(r.concat(w)),0)}})},iua=function(p,a,l,y,S,n){var V,z,d;
return g.R(function(G){V="STREAM_TYPE_UNKNOWN";l.video&&l.audio?(V="STREAM_TYPE_AUDIO_AND_VIDEO",Dy("unexpected stream type")):l.video&&!l.audio?V="STREAM_TYPE_VIDEO":!l.video&&l.audio&&(V="STREAM_TYPE_AUDIO");z=g.m8(a,"offlineVideoStreams");d={numBytesDownloaded:S.toFixed(),numTotalBytes:n.toFixed(),streamType:V,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(y),itag:V==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(l.itag):void 0};return g.u(G,rS(p,{mode:"readwrite",Gn:!0},
function(B){var c=wS(B,z,"offlineVideoStreams"),r=wS(B,g.m8(a,"transfer"),"transfer");return g.Qn.all([c,r]).then(function(w){w=g.t(w);var P=w.next().value;w=w.next().value;if(!w)return e7(B,z).then(function(){});
var F=E3c(P);P=DE_(P,y,d,z);var v=$f(B,P,"offlineVideoStreams");E3c(P)>F&&(w.lastProgressTimeMs=Date.now().toString());F=[v];w.offlineVideoStreams||(w.offlineVideoStreams=[]);w.offlineVideoStreams.indexOf(z)===-1&&(w.offlineVideoStreams.push(z),F.push($f(B,w,"transfer")));return g.Qn.all(F)})}),0)})},ThB=function(){Ny.apply(this,arguments)},Nhl=function(){Ny.apply(this,arguments)},v3B=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},sqb=function(){Ny.apply(this,arguments)},hI_=function(p,a){var l,y,S;
return g.R(function(n){switch(n.L){case 1:l=My(a);g.$r(n,2);y=g.xj(a.entityKey).entityId;if(y==="!*$_ALL_ENTITIES_!*$")return g.u(n,UEW(p.L),5);S=g.m8(y,"videoPlaybackPositionEntity");return g.u(n,Qq8(p.L,S),5);case 5:g.L8(n,3);break;case 2:return g.L6(n),n.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return n.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},unb=function(p){return{context:g.Ha(),
videoIds:p}},dE1=function(p){return g.R(function(a){return a.return(zPb(p))})},AS=function(p){var a,l;
return g.R(function(y){if(y.L==1)return g.u(y,Dj1(),2);if(y.L!=3){a=y.S;if(!a)throw Error("Cache API not supported");return p.length?g.u(y,a.open("yt-player-local-img"),3):y.return()}l=y.S;return g.u(y,l.addAll(p),0)})},AAc=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w;
return g.R(function(P){switch(P.L){case 1:return l=My(a),g.u(P,mi(p.L,"videoPlaybackPositionEntity"),2);case 2:y=P.S;if(y.length===0)return P.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.$r(P,3);return g.u(P,Vf.getInstance(),5);case 5:S=P.S;if(!S)throw Error("prefStorage is undefined");return g.u(P,S.get("psi"),6);case 6:return n=P.S,d=(z=(V=n)==null?void 0:V.H7)!=null?z:"0",g.u(P,wQG(y,d),7);case 7:return G=P.S,B={isPaused:G.watchHistoryPaused,H7:G.syncTimestampUsec},g.u(P,S.set("psi",
B),8);case 8:if(B.isPaused){P.g7(9);break}c=g.T(G.frameworkUpdates,gS);if(!G.frameworkUpdates||!c){P.g7(9);break}return g.u(P,Hua(c),9);case 9:g.L8(P,4);break;case 3:return r=g.L6(P),w="PPE handleRefresh error: "+(r instanceof Error?r.message:"unknown error"),Dy(w),P.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return P.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},JS=function(p,a){p.api.jl("woffle",{mcte:a});
Dy("missing current transfer entity.")},D$G=function(p){var a,l,y;
return g.R(function(S){if(S.L==1)return p?g.u(S,tS(p,g.M2,"mainDownloadsListEntity"),2):S.return([]);a=S.S;return((l=a)==null?0:(y=l.downloads)==null?0:y.length)?S.return(a.downloads.map(function(n){var V;return(V=n.videoItem)!=null?V:""})):S.return([])})},RyB=function(p,a,l,y){if(!p.action.entityKey)throw Error("entityKey is missing.");
var S=g.xj(p.action.entityKey);S={entityType:S.Ni,entityId:S.entityId,offlineOrchestrationActionType:p.action.actionType,orchestrationAction:{orchestrationActionId:p.actionId}};a&&(S.offlineOrchestrationActionResult=a.status,S.isRetryable=l?!1:a.L,a.U&&(S.offlineOrchestrationFailureReason=g3b(a.U,S.isRetryable)));var n,V;if((n=p.action.actionMetadata)==null?0:(V=n.offlineLoggingData)==null?0:V.offlineModeType)S.offlineModeType=p.action.actionMetadata.offlineLoggingData.offlineModeType;y&&(S.additionalOrchestrationActions=
y.map(function(z){return{orchestrationActionId:z.actionId}}));
return S},oql=function(p){if(!p.U&&!p.L){var a=YiU();
if(a){p.U=!0;var l=g.Bi("OfflineLockManager");a.request("woffle_orchestration_leader:"+l,{},function(){var y,S;return g.R(function(n){switch(n.L){case 1:return g.$r(n,2),p.S=new g.rQ,p.L=!0,p.U=!1,g.u(n,p.Z(),4);case 4:return g.u(n,p.S.promise,5);case 5:g.L8(n,0);break;case 2:y=g.L6(n),p.TX(),y instanceof Error&&(S=y,S.args=[{name:"WoLockManagerError",LQ:y.name}],g.iO(S)),g.lD(n)}})})}}},Q8_=function(p,a,l){a={offlineVideoData:a,
playlistId:l};if(p=g.T(p.actionMetadata,iN_))a.maximumDownloadQuality=p.maximumDownloadQuality;return{mainVideoEntityActionMetadata:a}},ZZ=function(p,a){var l,y,S,n,V,z,d,G,B,c,r;
return g.R(function(w){if(w.L==1)return l=g.m8(a,"transfer"),y=g.m8(a,"videoDownloadContextEntity"),g.u(w,rS(p,{mode:"readonly",Gn:!0},function(P){return g.Qn.all([wS(P,l,"transfer"),wS(P,y,"videoDownloadContextEntity")])}),2);
S=w.S;n=g.t(S);V=n.next().value;z=n.next().value;d=V;G=z;r={videoId:a,cotn:(B=d)==null?void 0:B.cotn,offlineModeType:(c=G)==null?void 0:c.offlineModeType};return w.return(r)})},eP7=function(p){var a=qi_[p];
if(a)return a;g.Mf(new g.kc("Entity model not found.",{entityType:p}))},JAW=function(){Ny.apply(this,arguments)},f2U=function(p,a){var l,y,S,n,V,z,d;
return g.R(function(G){if(G.L==1)return l=g.m8("music_downloads_library_id","musicDownloadsLibraryEntity"),g.u(G,tS(p,l,"musicDownloadsLibraryEntity"),2);y=G.S;if(!y)return G.g7(0);S=g.xj(a).entityType;S==="musicTrack"?n=y.downloadedTracks:S==="musicPlaylist"&&(n=y.downloadedPlaylists);if((V=n)==null?0:V.length)for(z=0;z<n.length;z++)if(d=n[z],d===a){n.splice(z,1);break}return g.u(G,PC(p,y,"musicDownloadsLibraryEntity"),0)})},wS=function(p,a,l){return p.L.objectStore("EntityStore").get(a).then(function(y){if(y){if(l&&
y.entityType!==l)throw Error("Incorrect entity type");
return Cia(p,y)}})},pGl=function(p){var a,l;
return g.R(function(y){if(y.L==1)return g.u(y,dS(),2);if(y.L!=3){a=y.S;if(!a)return Dy("PES is undefined"),y.return();p.S=new vPU(a,p.api,p.U,p.L);l=p.Ki(a);return g.u(y,PT_(a,l,p.U,p.L,p.Y),3)}p.K=y.S;return g.u(y,uSc(p),0)})},aV8=function(){Ny.apply(this,arguments)},sel=function(p,a){var l;
return g.R(function(y){if(!p.L)return y.return();l=p.L;return g.u(y,rS(p.S,{mode:"readwrite",Gn:!0},function(S){var n=[$f(S,l,"transfer")];a&&n.push(a(S));return g.Qn.all(n)}),0)})},lVW=function(p){p=p*1E3-Date.now();
return p>4E3?4E3:p},X3c=function(p,a,l,y){var S=FPM(p.S,1);
return wS(p,a,y).then(function(n){if(n){n=g.yY(n,l);var V={key:a,entityType:y,data:Iia(S,n,a),version:1};return g.Qn.all([g.U8(p.L.objectStore("EntityStore"),V),fnU(p,n,y)])}}).then(function(){cC(p,a,y);
return a})},Dj1=function(){return g.R(function(p){if(p.L==1)return g.u(p,mEW(),2);
if(!p.S)return p.return(void 0);ys_||(ys_=new CTW);return p.return(ys_)})},SCb=function(p,a){var l;
return g.R(function(y){return a.length?(l=v3B(),g.HD(l,Yf,{isEnqueuedForExpiredStreamUrlRefetch:!0}),p.api.jl("qrd",{v:a.length}),y.return(j7(p,a,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",l))):y.return([])})},nr2=function(){gL.apply(this,arguments)},g3b=function(p,a){return p!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||a?p==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&a?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":p:
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},QK_=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w;
return g.R(function(P){l=[];y=Infinity;S=4E3;n=g.t(a);for(V=n.next();!V.done;V=n.next())z=V.value,d=Number(z.enqueueTimeSec),G=lVW(d),B=z.retryScheduleIndex,c=B!=null&&B>0,G>0&&c?(y=Math.min(y,d),S=Math.min(G,S)):l.push(z);isFinite(y)&&(!p.U.isActive()||y<p.Z)&&(p.Z=y,p.U.start(S));p.G.Dd()||(r=l.length,l=l.filter(function(F){var v;F=((v=F.actionProto)==null?void 0:v.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!VFc.includes(F)}),w=l.length<r,!p.U.isActive()&&w&&p.U.start(1));
l.length>0&&gP_(p,l);return g.u(P,$Ec(p),0)})},Y9c=function(p){var a;
return g.R(function(l){if(l.L==1)return g.u(l,g.jJE(p),2);a=l.S;return l.return(a.filter(function(y){return!!y.url}).map(function(y){return y.url}))})},JU8=function(p,a){if(a)for(var l=0;l<p.actions.length;l++)if(a==="!*$_ALL_ENTITIES_!*$"&&p.actions[l].actionId!==a||a!=="!*$_ALL_ENTITIES_!*$"&&p.actions[l].rootActionId===a&&p.actions[l].actionId!==a)p.actions.splice(l,1),l--},Iia=function(p,a,l){try{return p.U(a,l)}catch(y){Ev2(y,nv1)}},s8G=function(p,a,l,y){var S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,
H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh,OM,q7,u_,i_,p8,G5,km,Kc,lF,eb,C,ar,e_,qQ,jb,Qo,pc,yB,U7,K;
return g.R(function(x){switch(x.L){case 1:return S=g.m8(p,"mainPlaylistEntity"),n=g.m8(p,"ytMainChannelEntity"),g.u(x,rS(a,{mode:"readonly",Gn:!0},function(e){return g.Qn.all([wS(e,S,"mainPlaylistEntity"),wS(e,n,"ytMainChannelEntity"),fQ(e,"mainPlaylistEntity"),fQ(e,"mainDownloadsListEntity"),fQ(e,"ytMainChannelEntity"),fQ(e,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:V=x.S;z=g.t(V);d=z.next().value;G=z.next().value;B=z.next().value;c=z.next().value;r=z.next().value;w=z.next().value;P=d;F=G;v=B;I=c;b=r;O=w;if(!P&&!F){x.g7(3);break}m=P?PEc(P):[];if(!F){H=[];x.g7(4);break}return g.u(x,OIU(F,b),5);case 5:H=x.S;case 4:return Y=H,g.u(x,I3(m.concat(Y)),3);case 3:N=[];yo=new Map;if(!P){x.g7(7);break}return g.u(x,xEW(P,v,I),8);case 8:N=x.S;zq=g.t(N);for(S$=zq.next();!S$.done;S$=zq.next())BE=S$.value,yo.set(BE,{videoId:BE,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.u(x,rS(a,{mode:"readonly",Gn:!0},function(e){return g.Qn.all([fQ(e,"transfer"),fQ(e,"videoDownloadContextEntity")])}),9);
case 9:f=x.S;xh=g.t(f);Nf=xh.next().value;nc=xh.next().value;yU=Nf;kh=nc;OM=g.t(yU);for(q7=OM.next();!q7.done;q7=OM.next())u_=q7.value,i_=g.xj(u_.key).entityId,(p8=yo.get(i_))&&u_&&(p8.cotn=u_.cotn);G5=g.t(kh);for(km=G5.next();!km.done;km=G5.next())Kc=km.value,lF=g.xj(Kc.key).entityId,(eb=yo.get(lF))&&Kc&&(eb.offlineModeType=Kc.offlineModeType);case 7:C=[];ar=g.t(O);for(e_=ar.next();!e_.done;e_=ar.next())qQ=e_.value,jb=g.xj(qQ.key).entityId,Qo=zn(qQ),jb!==p&&Qo.rootActionId!==p||S7(l,qQ.actionProto)||
C.push(qQ.key);pc=g.m8(p,"mainPlaylistEntity");return g.u(x,rS(a,{mode:"readwrite",Gn:!0},function(e){var k=C.map(function(Q){return e7(e,Q)});
k.push(e7(e,pc,{WA:!0}));return g.Qn.all(k)}),10);
case 10:if(!P){x.g7(0);break}N.reverse();if(!N){x.g7(0);break}yB=g.t(N);U7=yB.next();case 13:if(U7.done){x.g7(0);break}K=U7.value;return g.u(x,o3(K,a,l,y,yo.get(K)),14);case 14:U7=yB.next(),x.g7(13)}})},Z6U=function(){Ny.apply(this,arguments)},My=function(p){var a,l,y;
return((y=(a=p.actionMetadata)==null?void 0:(l=a.retryScheduleIntervalsInSeconds)==null?void 0:l.length)!=null?y:0)>0},orG=function(p,a,l){var y,S;
g.R(function(n){switch(n.L){case 1:if(!p.L)return JS(p,"onTransferProgress: "+a),n.return();if(p.L.transferState==="TRANSFER_STATE_TRANSFERRING"){n.g7(2);break}return g.u(n,Qe7(p),2);case 2:y=Date.now();if(!(y-p.QY>1E3)){n.g7(4);break}p.QY=y;return g.u(n,iua(p.S,l.videoId,l.S,l.Te,l.bytesDownloaded,l.L),5);case 5:if(p.Sl&&!(p.Sl&&y-p.UO>p.OO)){n.g7(4);break}p.UO=y;return g.u(n,UJ(p,a),7);case 7:S=n.S,U8M({videoId:a,F_:p.L,offlineModeType:S},l.bytesDownloaded,l.L);case 4:p.j.start(108E5),g.lD(n)}})},
NQB=function(p){var a;
if((a=p.onResponseReceivedActions)!=null&&a.length){var l;p=(l=g.T(g.T(p.onResponseReceivedActions[0],zCW),g.aQc))==null?void 0:l.actions;if(p!=null&&p.length)return p}},dAK=function(){Ny.apply(this,arguments)},G32=function(){Ny.apply(this,arguments)},BBc=function(p,a){var l,y;
return g.R(function(S){switch(S.L){case 1:return l=My(a),g.$r(S,2),y=g.xj(a.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.u(S,Nq(p.L,a,p.U),5):g.u(S,iA(y,"musicAlbumRelease",p.L,a,p.U),6);case 6:return g.u(S,f2U(p.L,a.entityKey),5);case 5:g.L8(S,3);break;case 2:return g.L6(S),S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},Ak8=function(p,a){a=g.t(a);
for(var l=a.next();!l.done;l=a.next())l=l.value,p5W(l,1),p.actions.push(l);p.actions.sort(p.L)},l2U=function(p,a,l){var y,S,n,V,z,d,G,B,c,r,w,P;
return g.R(function(F){switch(F.L){case 1:y=a.retryScheduleIndex+2===3;if(l.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){F.g7(2);break}if(l.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){F.g7(0);break}Mo8(a,l,y);if(l.L&&a.retryScheduleIndex+1<3)return g.u(F,Kxb(p,[a]),0);n=((S=l)==null?0:S.S)?l.S:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";V={entityKey:a.action.entityKey,failureReason:n};z=void 0;g.Z0(p.Y)?z="mainVideoDownloadStateEntity":g.dB(p.Y)&&(z="musicTrackDownloadMetadataEntity");
if(!z||!l.downloadState){F.g7(7);break}d=g.xj(a.action.entityKey).entityId;return g.u(F,CS(d,z,p.S,l.downloadState),7);case 7:sJ(p.K,V);if(l.downloadState==="DOWNLOAD_STATE_FAILED"&&p.Y.D("html5_auto_retry_failed_pde_actions")){F.g7(0);break}Dy("Orchestration result is not retryable, deleting action");return g.u(F,Qq8(p.S,ON(a).key),0);case 2:G=void 0;try{G=(B=l.j)==null?void 0:B.map(function(v){return p.createAction(v,a)})}catch(v){return Mo8(a,l,y),c={entityKey:a.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},sJ(p.K,c),Dy("Orchestration subactions creation error",v),F.return()}Mo8(a,l,y,G);if(!G){F.g7(12);break}r=G.map(function(v){return ON(v)});
w=0;case 13:if(!(w<G.length)||p.W){F.g7(15);break}return g.u(F,rS(p.S,{mode:"readwrite",Gn:!0},function(v){var I=[];I.push(Xs7(v,r.slice(w,w+10),"offlineOrchestrationActionWrapperEntity"));return g.Qn.all(I)}),16);
case 16:w+=10;F.g7(13);break;case 15:if(p.W)return p.W=!1,F.return();case 12:return P=ON(a),g.u(F,Qq8(p.S,P.key),17);case 17:p5W(a,4),g.lD(F)}})},csG=function(){Ny.apply(this,arguments)},BQW=function(p,a){var l,y,S,n,V,z,d,G,B;
return g.R(function(c){if(c.L==1)return l=g.m8("music_downloads_library_id","musicDownloadsLibraryEntity"),g.u(c,tS(p,l,"musicDownloadsLibraryEntity"),2);(y=c.S)||(y={id:l});S=g.xj(a).entityType;S==="musicTrack"?(n=y.downloadedTracks)!=null&&n.includes(a)||(y.downloadedTracks=((V=y.downloadedTracks)!=null?V:[]).concat(a)):S==="musicPlaylist"?(z=y.downloadedPlaylists)!=null&&z.includes(a)||(y.downloadedPlaylists=((d=y.downloadedPlaylists)!=null?d:[]).concat(a)):S!=="musicAlbumRelease"||(G=y.downloadedAlbumReleases)!=
null&&G.includes(a)||(y.downloadedAlbumReleases=((B=y.downloadedAlbumReleases)!=null?B:[]).concat(a));return g.u(c,PC(p,y,"musicDownloadsLibraryEntity"),0)})},rsW=function(){Ny.apply(this,arguments)},wGl=function(p,a){var l,y,S,n,V,z,d,G,B;
return g.R(function(c){switch(c.L){case 1:return l=a.entityKey,S=(y=g.T(a.actionMetadata,Yf))==null?void 0:y.isEnqueuedForExpiredStreamUrlRefetch,g.$r(c,2),n=void 0,g.u(c,pQU(p,a),4);case 4:n=c.S;g.$r(c,5);var r=(r=g.T(a.actionMetadata,Yf))?{maximumDownloadQuality:r.maximumDownloadQuality}:void 0;return g.u(c,aT1(l,p.Y,{isEnqueuedForExpiredStreamUrlRefetch:S,XA:r,offlineSourceData:n}),7);case 7:V=c.S;g.L8(c,6,2);break;case 5:return g.L6(c,2),z=My(a)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Dy("PDE handleAdd error"),c.return(Mq(a,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",z,"DOWNLOAD_STATE_FAILED"));case 6:return g.u(c,lTU(p,V,a),8);case 8:return c.return(Mq(a,!0,V.orchestrationActions));case 2:return d=g.L6(c),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.ka&&d.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Dy("PDE handleAdd error"),c.return(Mq(a,!1,void 0,G,B,"DOWNLOAD_STATE_FAILED"))}})},hS=function(p){if(!p||!p.thumbnails)return[];
var a=[];p=g.t(p.thumbnails);for(var l=p.next();!l.done;l=p.next())l=l.value,l.url&&a.push(l.url);return a},$Ac=function(p,a){var l,y,S,n,V,z,d,G,B,c;
return g.R(function(r){switch(r.L){case 1:return l=My(a),g.$r(r,2),y=g.xj(a.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.u(r,NfB(p.L,a,p.U,(B=a.actionMetadata)==null?void 0:(c=B.offlineLoggingData)==null?void 0:c.offlineDeleteReason),5):g.u(r,ZZ(p.L,y),6);case 6:S=r.S;n=g.T(a.actionMetadata,qy);if(z=(V=n)==null?void 0:V.playlistId)S.playlistId=z;S.offlineDeleteReason=(d=a.actionMetadata)==null?void 0:(G=d.offlineLoggingData)==null?void 0:G.offlineDeleteReason;return g.u(r,o3(y,p.L,a,p.U,S),7);
case 7:if(!p.Y.D("woffle_enable_main_downloads_library")){r.g7(5);break}return g.u(r,sJK(p.L,a.entityKey),5);case 5:g.L8(r,3);break;case 2:return g.L6(r),r.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},QS=function(p,a){var l=a.videoId;
var y=a.F_;a=a.offlineModeType;p.encryptedVideoId=l;p.cotn=y==null?void 0:y.cotn;p.offlineabilityFormatType=y==null?void 0:y.maximumDownloadQuality;var S;p.isRefresh=(S=y==null?void 0:y.isRefresh)!=null?S:!1;var n;p.softErrorCount=(n=y==null?void 0:y.transferRetryCount)!=null?n:0;p.offlineModeType=a!=null?a:"OFFLINE_NOW";(p.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&p.statusType==="UNKNOWN_STATUS_TYPE"||!p.transferStatusType&&!p.statusType)&&g.Mf(Error("Woffle unknown transfer status"));
g.mf("offlineTransferStatusChanged",p)},lTU=function(p,a,l){var y,S,n,V,z;
return g.R(function(d){if(d.L==1){if(!a.frameworkUpdates||!g.T(a.frameworkUpdates,gS))return d.return();if(!(g.T(a.frameworkUpdates,gS).mutations&&g.T(a.frameworkUpdates,gS).mutations.length>0&&g.T(a.frameworkUpdates,gS).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return d.g7(2);y=g.xj(g.T(a.frameworkUpdates,gS).mutations[0].entityKey).entityId;return g.u(d,ZZ(p.L,y),3)}if(d.L!=2){S=d.S;n=g.T(l.actionMetadata,Yf);if(z=(V=n)==null?void 0:V.playlistId)S.playlistId=z;S.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Z0(p.Y)?g.u(d,o3(y,p.L,l,p.U,S),2):g.dB(p.Y)?g.u(d,WC(y,p.L,l,p.U),2):d.g7(2)}return g.u(d,Hua(g.T(a.frameworkUpdates,gS)),0)})},Pxc=function(p,a){var l,y,S,n,V,z,d;
return g.R(function(G){switch(G.L){case 1:if(a.length===0)return G.return([]);l=a.map(function(B){return g.m8(B,"transfer")});
return g.u(G,mi(p.L,"transfer",l),2);case 2:y=G.S;S=y.filter(eBc).map(function(B){return g.xj(B.key).entityId});
n=a.filter(function(B){return S.indexOf(B)===-1});
if(n.length===0)return G.return([]);V=g.t(n);z=V.next();case 3:if(z.done){G.g7(5);break}d=z.value;return g.u(G,dE1(d),4);case 4:z=V.next();G.g7(3);break;case 5:return G.return(n)}})},pQU=function(p,a){var l,y,S,n;
return g.R(function(V){if(V.L==1)return l=g.xj(a.entityKey).entityId,y=g.m8(l,"videoDownloadContextEntity"),g.u(V,tS(p.L,y,"videoDownloadContextEntity"),2);S=V.S;return(n=S)!=null&&n.offlineModeType?V.return({offlineModeType:S.offlineModeType}):V.return(void 0)})},LgW=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!p.entityKey},XGb=function(p,a){a=a===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":a;
var l,y,S,n;return g.R(function(V){if(V.L==1)return p.L||JS(p,"setTransferToFailed: "+a),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a==="TRANSFER_FAILURE_REASON_NETWORK"?l="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":a==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.u(V,pS(p,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",a),2);if(V.L!=3)return sJ(p.Xu,{entityKey:(y=p.L)==null?void 0:y.key,failureReason:l}),
S=p.L?g.xj(p.L.key).entityId:"",g.u(V,UJ(p,S),3);n=V.S;var z={videoId:S,F_:p.L,offlineModeType:n},d=a,G={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};d&&(G.transferFailureReason=d,G.failureReason=OuG(d));QS(G,z);g.lD(V)})},xAB=function(){Ny.apply(this,arguments)},Fga=function(){Ny.apply(this,arguments)},Nq=function(p,a,l){var y,S,n,V,z,d,G;
return g.R(function(B){if(B.L==1)return g.u(B,rS(p,{mode:"readwrite",Gn:!0},function(c){var r=fQ(c,"transfer"),w=fQ(c,"offlineOrchestrationActionWrapperEntity");return g.Qn.all([r,w]).then(function(P){P=g.t(P);var F=P.next().value;var v=P.next().value;P=ErB.map(function(m){return Gfb(c,m)});
v=g.t(v);for(var I=v.next();!I.done;I=v.next()){I=I.value;var b=g.xj(I.actionProto.entityKey).entityType==="musicTrack",O=I.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";S7(a,I.actionProto)||b&&(!b||O)||P.push(e7(c,I.key,{WA:!0}))}return g.Qn.all(P).then(function(){return F})})}),2);
y=B.S;S=g.t(y);for(n=S.next();!n.done;n=S.next())V=n.value,R3(V),z=g.xj(V.key).entityId,d={videoId:z,offlineDeleteReason:void 0,cotn:V.cotn},XQ(d),G=g.m8(z,"musicTrack"),sJ(l,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.u(B,i$c(),0)})},le=function(p,a){var l=g.xY(a);
if(l===1||l===0)return Promise.resolve();(l=tZ8(p,a))&&l.stopVideo();p.U=0;return dE1(a)},M0l=function(){var p,a,l;
return g.R(function(y){if(y.L==1)return g.$r(y,2),g.u(y,g.Nb(),4);if(y.L!=2){p=y.S;if(!p||!g.ci()||typeof g.dD.BroadcastChannel==="undefined")return y.return();a=new Cx8;return y.return(new LS(p,a))}l=g.L6(y);l instanceof Error&&g.iO(l);return y.return()})},Wm=function(p,a,l,y,S,n){a=g.m8(a,l);
y=Object.assign({},n,{priority:y,retryScheduleIntervalsInSeconds:S});return{actionType:p,entityKey:a,actionMetadata:y}},vrc=function(p,a){var l,y;
return g.R(function(S){switch(S.L){case 1:return l=My(a),g.$r(S,2),y=g.xj(a.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.u(S,Nq(p.L,a,p.U),5):g.u(S,WC(y,p.L,a,p.U),6);case 6:return g.u(S,f2U(p.L,a.entityKey),5);case 5:g.L8(S,3);break;case 2:return g.L6(S),S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},Kg_=function(p,a){this.L=p;
this.Y=a},tZ8=function(p,a){var l;
return((l=p.player)==null?void 0:l.getVideoData().videoId)===a?p.player:null},jqM=function(p){return g.bx(Cv_(),p)},b6M=function(p,a){var l,y,S,n,V,z,d,G;
return g.R(function(B){switch(B.L){case 1:return l=My(a),y=g.xj(a.entityKey).entityId,g.$r(B,2),g.u(B,Vf.getInstance(),4);case 4:S=B.S;if(!S)throw Error("prefStorage is undefined");return g.u(B,S.get("psi"),5);case 5:n=B.S;V=g.T(a.actionMetadata,eCb);if(((z=n)==null?void 0:z.isPaused)!==!1||(d=V)==null||!d.lastPlaybackPositionSeconds){B.g7(6);break}G={key:g.m8(y,"videoPlaybackPositionEntity"),videoId:y,lastPlaybackPositionSeconds:V.lastPlaybackPositionSeconds};return g.u(B,PC(p.L,G,"videoPlaybackPositionEntity"),
6);case 6:g.L8(B,3);break;case 2:return g.L6(B),B.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},Cx8=function(){this.L={};
this.L[0]=new Ai;if(!g.oO("aes_pes_encoder_killswitch")){var p=this.L;try{var a=g.Bi();var l=KWb(a);var y=new HC(new g.J$(l),new g.s4(l))}catch(S){throw p=S instanceof Error?new nS("KEY_CREATION_FAILED",{originalMessage:S.message}):new nS("KEY_CREATION_FAILED"),g.iO(p),p;}p[1]=y}},IVW=function(){Ny.apply(this,arguments)},RCb=function(){Ny.apply(this,arguments)},Qe7=function(p){var a,l,y;
return g.R(function(S){if(S.L==1){if(!p.L)return JS(p,"onTransferStart"),S.return();p.j.start(108E5);return g.u(S,pS(p,"TRANSFER_STATE_TRANSFERRING"),2)}a=p.L;return(y=((l=a)==null?0:l.key)?g.xj(a.key).entityId:"")&&p.U?g.u(S,CS(y,p.U,p.S,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):S.g7(0)})},qq=function(p){this.L=p},UJ=function(p,a){var l,y,S;
return g.R(function(n){if(n.L==1)return g.u(n,tS(p.S,g.m8(a,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);l=n.S;return n.return((S=(y=l)==null?void 0:y.offlineModeType)!=null?S:void 0)})},DE_=function(p,a,l,y){if(p&&p.streamsProgress){y=p;
a:{a=a.itag+";"+a.xtags;for(var S=p.streamsProgress,n=0;n<S.length;n++){var V=JSON.parse(S[n].formatStreamBytes);if(V.itag+";"+V.xtags===a){S[n]=l;l=S;break a}}S.push(l);l=S}y.streamsProgress=l}else p={key:y,streamsProgress:[l]};return p},u8a=function(p,a,l){var y,S,n,V,z,d,G,B,c,r,w,P,F,v;
return g.R(function(I){if(I.L==1){y=a.additionalMetadadatas;S=void 0;if(y&&y.length>0)for(n=g.t(y),V=n.next();!V.done;V=n.next())if(z=V.value,z.offlineMusicPlaylistData){S=z.offlineMusicPlaylistData;break}d=a.playlistId;G=je_(a);B=G.uR;c=G.td;r=l?(Number(l)*1E3).toString():Date.now().toString();w=a.lastModifiedTimestamp?(Number(a.lastModifiedTimestamp)*1E3).toString():"0";P={id:g.m8(d,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:c,lastModifiedTimestampMillis:w,addedTimestampMillis:r,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};F={id:g.m8(d,"musicAlbumRelease"),title:a.title,audioPlaylistId:d,trackCount:a.totalVideoCount,tracks:B,downloadMetadata:P.id};S&&(F.thumbnailDetails=(v=S.albumHqThumbnail)!=null?v:S.albumArtistThumbnail,F.artistDisplayName=S.albumArtistDisplayName,F.releaseDate=S.albumReleaseDate,F.contentRating={explicitType:S.albumReleaseExplicitType},F.releaseType=S.albumReleaseType);return g.u(I,rS(p.L,{mode:"readwrite",Gn:!0},function(b){var O=$f(b,F,"musicAlbumRelease");
b=$f(b,P,"musicAlbumReleaseDownloadMetadataEntity");return g.Qn.all([O,b])}),2)}return I.return(F)})},Dy=function(p,a,l){g.Mf(new g.kc("Woffle: "+p,l?{cotn:l}:""));
a instanceof Error&&g.Mf(a)},O6_=function(p,a){var l,y,S,n,V,z,d,G,B,c;
return g.R(function(r){switch(r.L){case 1:return l=My(a),y=g.xj(a.entityKey).entityId,g.u(r,rS(p.L,{mode:"readonly",Gn:!0},function(w){var P=wS(w,a.entityKey,"transfer");w=wS(w,g.m8(y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Qn.all([P,w])}),2);
case 2:S=r.S;n=g.t(S);V=n.next().value;z=n.next().value;d=V;G=z;if(!d||d.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return r.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l));g.$r(r,3);d.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.u(r,PC(p.L,d,"transfer"),5);case 5:B=g.xj(d.key).entityId;NpU({videoId:B,F_:d,offlineModeType:(c=G)==null?void 0:c.offlineModeType});g.L8(r,4);break;case 3:return g.L6(r),r.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return r.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l))}})},k3G=function(){Ny.apply(this,arguments)},MF_=function(){Ny.apply(this,arguments)},tF_=function(p){return g.R(function(a){if(a.L==1)a=g.u(a,mAc(),2);
else{var l=p.Bs;var y=g.FL();y=Object.keys(y);l=Pxc(l,y);a=g.u(a,l,0)}return a})},jb1=function(){Ny.apply(this,arguments)},Wg1=function(){Ny.apply(this,arguments)},KS=function(p,a){a=a===void 0?!1:a;
var l;return g.R(function(y){if(y.L==1){if(p.L)throw Error("Already downloading a video");p.UO=0;p.Z=!1;return g.u(y,q3M(p),2)}return y.L!=4?(l=y.S,gWc(p.r7,!l),l&&p.G.Dd()?a?g.u(y,new Promise(function(S){g.aY(S,1E3)}),4):y.g7(4):(!l&&p.L&&vC(p),y.g7(0))):g.u(y,q9l(p,l),0)})},$xK=function(p,a,l,y){var S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m;
return g.R(function(H){switch(H.L){case 1:S=Date.now().toString();l||(l=S);n=a.videos;V=a.playlistId;z=[];d=[];if(n)for(G=g.t(n),B=G.next();!B.done;B=G.next()){c=B.value;r=c.offlineVideoData;if(!r||!r.videoId)throw Dy("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");w=r.videoId;P={videoId:w,playlistId:V};F={id:g.m8(JSON.stringify(P),"mainPlaylistVideoEntity"),video:g.m8(w,"mainVideoEntity")};z.push(F);d.push(F.id)}I={key:g.m8(V,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:l,lastSyncedTimestampMillis:S};b={key:g.m8(V,"mainPlaylistEntity"),playlistId:V,videos:d,title:a.title,thumbnailStyleData:mxU(a),visibility:bNb(a),downloadState:I.key};a.channel&&(O=a.channel.offlineChannelData,v=vqc(g.m8(V,"ytMainChannelEntity"),O),b.channelOwner=v.id);((m=b)==null?0:m.entityMetadata)?(b.entityMetadata.offlineLastModifiedTimestampSeconds=a.lastModifiedTimestamp,y&&(b.entityMetadata.nextAutoRefreshIntervalSeconds=String(y))):b&&(b.entityMetadata={nextAutoRefreshIntervalSeconds:y?
String(y):void 0,offlineLastModifiedTimestampSeconds:a.lastModifiedTimestamp});g.$r(H,2);return g.u(H,rS(p.L,{mode:"readwrite",Gn:!0},function(Y){var N=$f(Y,b,"mainPlaylistEntity"),yo=$f(Y,I,"mainPlaylistDownloadStateEntity");N=[N,yo];yo=g.t(z);for(var zq=yo.next();!zq.done;zq=yo.next())N.push($f(Y,zq.value,"mainPlaylistVideoEntity"));v&&N.push($f(Y,v,"ytMainChannelEntity"));return g.Qn.all(N)}),4);
case 4:g.L8(H,3);break;case 2:throw g.L6(H),Dy("PES failure for playlist"),Error("PES failure for playlist");case 3:return H.return({mainPlaylistEntity:b,kOO:v,pxO:z})}})},Qq8=function(p,a){return rS(p,{mode:"readwrite",
Gn:!0},function(l){return e7(l,a)})},H6c=function(p,a){this.L=p;
this.U=a},UN=function(p,a,l,y,S){g.D.call(this);
var n=this;this.S=p;this.w7=a;this.UO=l;this.K=y;this.Y=S;this.L=new FDa;this.G=new g.RA;this.U=new g.l_(function(){n.retry()});
this.Z=NaN;this.W=!1;this.hg={vpY:function(){return n.L},
n5:function(){return n.G},
MgI:function(){return n.U},
retry:function(){return n.retry()}};
g.E(this,this.U);this.Sl=this.S.observe(this.Xu.bind(this))},UEW=function(p){return rS(p,{mode:"readwrite",
Gn:!0},function(a){return Gfb(a,"videoPlaybackPositionEntity")})},a21=function(p,a){var l,y,S,n,V,z;
return g.R(function(d){switch(d.L){case 1:l=new Map,y=g.t(a),S=y.next();case 2:if(S.done){d.g7(4);break}n=S.value;V=l;z=V.set;return g.u(d,p.S(n),5);case 5:z.call(V,n,d.S);S=y.next();d.g7(2);break;case 4:return d.return(l)}})},DAl=function(p,a){var l,y;
return g.R(function(S){switch(S.L){case 1:return l=My(a),g.$r(S,2),y=g.xj(a.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.u(S,Nq(p.L,a,p.U),5):g.u(S,iA(y,"musicPlaylist",p.L,a,p.U),6);case 6:return g.u(S,f2U(p.L,a.entityKey),5);case 5:g.L8(S,3);break;case 2:return g.L6(S),S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return S.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
l))}})},i6K=function(p,a,l){a=a===void 0?43200:a;
l=l===void 0?!0:l;var y=y===void 0?!1:y;var S,n,V;return g.R(function(z){switch(z.L){case 1:if(!p.G.Dd())return z.return([]);S=[];g.$r(z,2);return g.u(z,Tf2(a,l,y),4);case 4:S=z.S;g.L8(z,3);break;case 2:n=g.L6(z),n instanceof Error&&n.message==="No data"||n instanceof Error&&n.message==="Empty response body"&&Dy(n.message);case 3:return V=Zuc(p,S,l,"mainPlaylistEntity"),z.return(V)}})},TB_=function(){Ny.apply(this,arguments)},m8c=function(p,a,l){var y,S,n;
return g.R(function(V){switch(V.L){case 1:return g.u(V,w37([a]),2);case 2:return y=V.S,g.u(V,u8a(p,y[0],l),3);case 3:return S=V.S,n=hS(S.thumbnailDetails),g.u(V,AS(n),4);case 4:return V.return(y[0].videos)}})},NBK=function(){Ny.apply(this,arguments)},w5c=function(p){var a;
return g.R(function(l){if(l.L==1)return g.u(l,mi(p.S,"offlineOrchestrationActionWrapperEntity"),2);a=l.S;return g.u(l,QK_(p,a),0)})},Ny=function(){gL.apply(this,arguments)},sKB=function(p,a,l,y){var S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh;
return g.R(function(OM){switch(OM.L){case 1:return g.u(OM,dS(),2);case 2:S=OM.S;if(!S)return OM.return([]);n=[];if((V=y)==null?0:V.length){n=y;OM.g7(3);break}return g.u(OM,mi(S,"musicPlaylist"),4);case 4:n=OM.S;case 3:if(!n.length)return OM.return([]);z=[];d=Date.now()/1E3;G=g.t(n);B=G.next();case 5:if(B.done)return z.length?g.u(OM,Z$B(z),10):OM.return([]);c=B.value;r=void 0;P=(w=(r=c)==null?void 0:r.entityMetadata)&&w.nextAutoRefreshIntervalSeconds?Number(w.nextAutoRefreshIntervalSeconds):NaN;F=
Number.isNaN(P)?p:P;I=v=0;b="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!c.downloadMetadata){OM.g7(8);break}return g.u(OM,tS(S,c.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:O=OM.S,H=m=void 0,v=Number((H=(m=O)==null?void 0:m.addedTimestampMillis)!=null?H:"0")/1E3,N=Y=void 0,I=Number((N=(Y=O)==null?void 0:Y.lastModifiedTimestampMillis)!=null?N:"0")/1E3,zq=yo=void 0,b=(zq=(yo=O)==null?void 0:yo.syncState)!=null?zq:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:S$=void 0;if(l||b!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!w||Number((S$=w.lastSyncedTimestampSeconds)!=null?S$:0)+F<=d){BE=[];f=void 0;if((f=c.tracks)==null?0:f.length)for(xh=g.t(c.tracks),Nf=xh.next();!Nf.done;Nf=xh.next())nc=Nf.value,BE.push(g.xj(nc).entityId);yU={playlistId:c.playlistId,videoIds:BE,offlineLastModifiedTimestamp:String(I.toFixed()),autoSync:a,offlineDateAddedTimestamp:String(v.toFixed())};z.push(yU)}B=G.next();OM.g7(5);break;case 10:return kh=OM.S,OM.return(kh)}})},sbG=function(p){var a,l,y,S,n;
g.R(function(V){switch(V.L){case 1:if(!p.L)return JS(p,"onTransferComplete"),V.return();a=p.L;p.j.stop();if(!a||!p.W){V.g7(2);break}l=Afc(p.api.C(),a.cotn,p.W);return g.u(V,gHc(p,l),2);case 2:return g.u(V,pS(p,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:S=((y=a)==null?0:y.key)?g.xj(a.key).entityId:"";if(!S||!p.U){V.g7(5);break}return g.u(V,CS(S,p.U,p.S,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.u(V,WP2(p.S,S),7);case 7:return g.u(V,UJ(p,S),8);case 8:n=V.S,QS({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:S,F_:a,offlineModeType:n}),vC(p),KS(p),g.lD(V)}})},UAK=function(p,a){var l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I;
return g.R(function(b){switch(b.L){case 1:return l=My(a),y=g.xj(a.entityKey),S=y.entityId,n=[],g.$r(b,2),g.u(b,HIc(p,S),4);case 4:n=b.S;if((V=n)==null||!V.length){b.g7(5);break}return g.u(b,BQW(p.L,a.entityKey),5);case 5:g.L8(b,3);break;case 2:return z=g.L6(b),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.ka&&z.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
b.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",l,void 0,d,G));case 3:return B=[],g.u(b,YZl(p.L,"musicTrack",n),7);case 7:n=b.S;if(n.length)for(c=g.t(n),r=c.next();!r.done;r=c.next())if(w=r.value,P=w.offlineVideoData,F=void 0,(F=P)==null?0:F.videoId)v=void 0,I=Number(((v=a.actionMetadata)==null?void 0:v.priority)||0)+1,B.push(Wm("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P.videoId,"musicTrack",I,sN,Ty(a,P,S)));return b.return(new jU("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",l,B))}})},
QbW=function(){Ny.apply(this,arguments)},n31=function(p){var a,l,y;
return g.R(function(S){if(S.L==1)return a=IDBKeyRange.bound(p+"|",p+"~"),g.u(S,g.Nb(),2);if(S.L!=3){l=S.S;if(!l)throw g.K6("gactfv");return g.u(S,g.Fl(l),3)}y=S.S;return S.return(y.getAll("captions",a))})},hC_=function(){Ny.apply(this,arguments)},e7=function(p,a,l){if(l==null?0:l.WA){var y=new Set;
return VPb(p,a,y).then(function(){for(var n=[],V=g.t(y),z=V.next();!z.done;z=V.next())n.push(e7(p,z.value));return g.Qn.all(n).then(function(){})})}var S=g.xj(a).entityType;
return g.Qn.all([p.L.objectStore("EntityStore").delete(a),qO7(p,a)]).then(function(){cC(p,a,S)})},Asb=function(){Ny.apply(this,arguments)},Hua=function(p){var a;
return g.R(function(l){if(l.L==1){a=p.mutations;if(!a||a.length<=0)return l.return();if(g.q6){var y={type:"ENTITY_LOADED"};a!==void 0&&(y.payload=a);g.q6.dispatch(y)}return g.u(l,xxU(a),2)}a.length=0;g.lD(l)})},mAc=function(){var p,a;
return g.R(function(l){if(l.L==1)return g.u(l,g.Nb(),2);if(l.L!=3){p=l.S;if(!p)throw g.K6("rvdfd");return g.u(l,g.Fl(p),3)}a=l.S;return l.return(g.Nk(a,["index","media"],{mode:"readwrite",Gn:!0},function(y){var S={};return g.JA(y.objectStore("index"),{},function(n){var V=n.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),z=g.Qn.resolve(void 0);if(V){var d=V[1];V=V[2];S[d]=S[d]||{};var G;S[d][V]=g.Mmr((G=n.getValue())==null?void 0:G.fmts)}else z=n.delete().then(function(){});
return g.Qn.all([g.Lt(n),z]).then(function(B){return g.t(B).next().value})}).then(function(){for(var n={},V=g.t(Object.keys(S)),z=V.next();!z.done;z=V.next()){z=z.value;
var d=S[z].v;n[z]=S[z].a&&d?1:2}var G=Bpc(n);return g.oWh(y.objectStore("media"),{},function(B){var c=B.cursor.key.match(g.p1f);c&&n[c[1]]||y.objectStore("media").delete(B.cursor.key);return g.iPr(B)}).then(function(){return G})})}))})},GAc=function(){var p,a,l,y,S;
return g.R(function(n){if(n.L==1)return g.u(n,dS(),2);if(n.L!=3)return(p=n.S)?g.u(n,mi(p,"refresh"),3):n.return(!1);a=n.S;if((l=a[0])==null||!l.refreshTime)return n.return(!1);y=Number(a[0].refreshTime);S=Date.now()/1E3;return n.return(isFinite(y)&&S>=y)})},gr2=function(){var p,a,l,y,S,n;
return g.R(function(V){switch(V.L){case 1:return g.u(V,dS(),2);case 2:p=V.S;if(!p)return V.return([]);a=Date.now()/1E3;return g.u(V,mi(p,"offlineVideoPolicy"),3);case 3:l=V.S,y=g.t(l),S=y.next();case 4:if(S.done){V.g7(6);break}n=S.value;if(!(n.expirationTimestamp&&Number(n.expirationTimestamp)<a)){V.g7(5);break}n.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";n.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.u(V,PC(p,n,"offlineVideoPolicy"),5);
case 5:S=y.next();V.g7(4);break;case 6:return V.return(l.map(function(z){return z.key}))}})},u4a=function(p,a){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:p},metadata:a,statusCode:void 0,csn:void 0,can:void 0}},YCW=function(p){if(p.includes(":"))throw Error("Invalid user cache name: "+p);
return p+":"+g.Bi("CacheStorage get")},YiU=function(){try{var p=g.o4("ytglobal.locks_");
if(p)return p;var a;if(a=navigator){var l=navigator;a="locks"in l&&!!l.locks}if(a)return g.dD.localStorage&&g.dD.localStorage.getItem("noop"),p=new $jM,g.M8("ytglobal.locks_",p),p}catch(y){}},R3=function(p,a){if(p&&p.transferState!=="TRANSFER_STATE_COMPLETE"&&p.transferState!=="TRANSFER_STATE_FAILED"){var l=g.xj(p.key).entityId;
QS({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:l,F_:p,offlineModeType:a})}};
g.dA.prototype.Y9=g.vr(45,function(p){return this.app.Y9(p)});
g.$T.prototype.Y9=g.vr(44,function(p){return g.dyf(this,9,p)});
g.A(Ny,gL);g.fU.Object.defineProperties(Ny.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.L.entityMetadata},
set:function(p){this.L.entityMetadata=p}}});
g.A(RI8,Ny);RI8.prototype.S=function(){return[]};
g.A(X5K,Ny);X5K.prototype.S=function(){return[]};
g.A(iPc,Ny);iPc.prototype.S=function(){return[]};
g.A(WLG,Ny);WLG.prototype.S=function(){return[]};
g.A(NMb,Ny);NMb.prototype.S=function(){return[]};
g.A(zyl,Ny);zyl.prototype.S=function(){var p=[];this.L.alternateChannel&&p.push(this.L.alternateChannel);this.L.alternateChannelList&&p.push.apply(p,g.u0(this.L.alternateChannelList));this.L.oneofChannelEntity&&p.push(this.L.oneofChannelEntity);return[].concat(g.u0(new Set(p)))};
g.A(vWl,Ny);vWl.prototype.S=function(){var p=[];this.L.entryCollection&&p.push(this.L.entryCollection);return[].concat(g.u0(new Set(p)))};
g.A(RPB,gL);RPB.prototype.S=function(){var p=[];this.L.video&&p.push(this.L.video);return[].concat(g.u0(new Set(p)))};
g.A(aV8,Ny);aV8.prototype.S=function(){var p=[];this.L.parentPlaylist&&p.push(this.L.parentPlaylist);if(this.L.entries)for(var a=g.t(this.L.entries),l=a.next();!l.done;l=a.next())p.push.apply(p,g.u0((new RPB(l.value)).S()));return[].concat(g.u0(new Set(p)))};
g.A(SiK,Ny);SiK.prototype.S=function(){var p=[];this.L.descriptionEntity&&p.push(this.L.descriptionEntity);this.L.creators&&p.push.apply(p,g.u0(this.L.creators));this.L.theBiggestFan&&p.push(this.L.theBiggestFan);return[].concat(g.u0(new Set(p)))};
g.A(HPa,Ny);HPa.prototype.S=function(){return[]};
g.A(Hl2,Ny);Hl2.prototype.S=function(){return[]};
g.A(D81,Ny);D81.prototype.S=function(){return[]};
g.A(IVW,Ny);IVW.prototype.S=function(){return[]};
g.A(jYl,Ny);jYl.prototype.S=function(){return[]};
g.A(rsW,Ny);rsW.prototype.S=function(){return[]};
g.A(oW1,Ny);oW1.prototype.S=function(){return[]};
g.A(lnc,Ny);lnc.prototype.S=function(){return[]};
g.A(sYb,Ny);sYb.prototype.S=function(){return[]};
g.A(TM2,Ny);TM2.prototype.S=function(){var p=[];this.L.downloadsList&&p.push(this.L.downloadsList);this.L.smartDownloadsList&&p.push(this.L.smartDownloadsList);this.L.recommendedDownloadsList&&p.push(this.L.recommendedDownloadsList);this.L.refresh&&p.push(this.L.refresh);return[].concat(g.u0(new Set(p)))};
g.A(SZW,gL);SZW.prototype.S=function(){var p=[];this.L.video&&p.push(this.L.video);this.L.playlist&&p.push(this.L.playlist);this.L.videoItem&&p.push(this.L.videoItem);this.L.playlistItem&&p.push(this.L.playlistItem);return[].concat(g.u0(new Set(p)))};
g.A(IqU,Ny);IqU.prototype.S=function(){var p=[];this.L.refresh&&p.push(this.L.refresh);if(this.L.downloads)for(var a=g.t(this.L.downloads),l=a.next();!l.done;l=a.next())p.push.apply(p,g.u0((new SZW(l.value)).S()));return[].concat(g.u0(new Set(p)))};
g.A(XVl,Ny);XVl.prototype.S=function(){var p=[];this.L.localImageEntities&&p.push.apply(p,g.u0(this.L.localImageEntities));return[].concat(g.u0(new Set(p)))};
g.A(e_W,Ny);e_W.prototype.S=function(){var p=[];this.L.playbackData&&p.push(this.L.playbackData);this.L.localImageEntities&&p.push.apply(p,g.u0(this.L.localImageEntities));this.L.videoDownloadContextEntity&&p.push(this.L.videoDownloadContextEntity);return[].concat(g.u0(new Set(p)))};
g.A(KyG,Ny);KyG.prototype.S=function(){return[]};
g.A(Tb7,Ny);Tb7.prototype.S=function(){var p=[];this.L.fakeChildren&&p.push.apply(p,g.u0(this.L.fakeChildren));return[].concat(g.u0(new Set(p)))};
g.A(ovc,Ny);ovc.prototype.S=function(){var p=[];this.L.video&&p.push(this.L.video);this.L.playbackData&&p.push(this.L.playbackData);this.L.offlineVideoPolicy&&p.push(this.L.offlineVideoPolicy);return[].concat(g.u0(new Set(p)))};
g.A(nPb,Ny);nPb.prototype.S=function(){return[]};
g.A(NBK,Ny);NBK.prototype.S=function(){var p=[];this.L.channelOwner&&p.push(this.L.channelOwner);this.L.videos&&p.push.apply(p,g.u0(this.L.videos));this.L.collaboratorChannels&&p.push.apply(p,g.u0(this.L.collaboratorChannels));this.L.downloadState&&p.push(this.L.downloadState);this.L.refresh&&p.push(this.L.refresh);return[].concat(g.u0(new Set(p)))};
g.A(vvB,Ny);vvB.prototype.S=function(){var p=[];this.L.video&&p.push(this.L.video);this.L.channelContributor&&p.push(this.L.channelContributor);return[].concat(g.u0(new Set(p)))};
g.A(nr2,gL);nr2.prototype.S=function(){var p=[];this.L.localImageEntities&&p.push.apply(p,g.u0(this.L.localImageEntities));this.L.videoDownloadContextEntity&&p.push(this.L.videoDownloadContextEntity);return[].concat(g.u0(new Set(p)))};
g.A(In2,gL);In2.prototype.S=function(){var p=[];this.L.recommendedVideoMetadata&&p.push.apply(p,g.u0((new nr2(this.L.recommendedVideoMetadata)).S()));return[].concat(g.u0(new Set(p)))};
g.A(WxK,gL);WxK.prototype.S=function(){var p=[];this.L.playbackPosition&&p.push(this.L.playbackPosition);return[].concat(g.u0(new Set(p)))};
g.A(SO1,Ny);SO1.prototype.S=function(){var p=[];this.L.owner&&p.push(this.L.owner);this.L.downloadState&&p.push(this.L.downloadState);this.L.userState&&p.push.apply(p,g.u0((new WxK(this.L.userState)).S()));this.L.additionalMetadata&&p.push.apply(p,g.u0((new In2(this.L.additionalMetadata)).S()));return[].concat(g.u0(new Set(p)))};
g.A(ThB,Ny);ThB.prototype.S=function(){var p=[];this.L.userChannelDetails&&p.push(this.L.userChannelDetails);return[].concat(g.u0(new Set(p)))};
g.A(nW1,Ny);nW1.prototype.S=function(){var p=[];this.L.channelOwner&&p.push(this.L.channelOwner);this.L.playbackPosition&&p.push(this.L.playbackPosition);this.L.localImageEntities&&p.push.apply(p,g.u0(this.L.localImageEntities));this.L.downloadStatus&&p.push(this.L.downloadStatus);return[].concat(g.u0(new Set(p)))};
g.A(UxU,Ny);UxU.prototype.S=function(){return[]};
g.A(p38,Ny);p38.prototype.S=function(){return[]};
g.A(x6W,Ny);x6W.prototype.S=function(){return[]};
g.A(jb1,Ny);jb1.prototype.S=function(){return[]};
g.A(LPM,Ny);LPM.prototype.S=function(){return[]};
g.A(kAG,Ny);kAG.prototype.S=function(){return[]};
g.A(ykG,Ny);ykG.prototype.S=function(){return[]};
g.A(WWG,Ny);WWG.prototype.S=function(){return[]};
g.A(blM,Ny);blM.prototype.S=function(){return[]};
g.A(JAW,Ny);JAW.prototype.S=function(){return[]};
g.A(xjU,Ny);xjU.prototype.S=function(){return[]};
g.A(S3l,Ny);S3l.prototype.S=function(){return[]};
g.A(eIc,Ny);eIc.prototype.S=function(){return[]};
g.A(FWM,Ny);FWM.prototype.S=function(){var p=[];this.L.compositeSourceKeys&&p.push.apply(p,g.u0(this.L.compositeSourceKeys));return[].concat(g.u0(new Set(p)))};
g.A(d6G,Ny);d6G.prototype.S=function(){var p=[];this.L.trackDownloadMetadatas&&p.push.apply(p,g.u0(this.L.trackDownloadMetadatas));return[].concat(g.u0(new Set(p)))};
g.A(ITc,Ny);
ITc.prototype.S=function(){var p=[];this.L.downloadedTracks&&p.push.apply(p,g.u0(this.L.downloadedTracks));this.L.smartDownloadedTracks&&p.push.apply(p,g.u0(this.L.smartDownloadedTracks));this.L.downloadedEpisodes&&p.push.apply(p,g.u0(this.L.downloadedEpisodes));this.L.downloadedAlbumReleases&&p.push.apply(p,g.u0(this.L.downloadedAlbumReleases));this.L.smartDownloadedAlbumReleases&&p.push.apply(p,g.u0(this.L.smartDownloadedAlbumReleases));this.L.downloadedPlaylists&&p.push.apply(p,g.u0(this.L.downloadedPlaylists));this.L.smartDownloadedPlaylists&&
p.push.apply(p,g.u0(this.L.smartDownloadedPlaylists));this.L.metadataOnlyTracks&&p.push.apply(p,g.u0(this.L.metadataOnlyTracks));return[].concat(g.u0(new Set(p)))};
g.A(Asb,Ny);Asb.prototype.S=function(){var p=[];this.L.trackDownloadMetadatas&&p.push.apply(p,g.u0(this.L.trackDownloadMetadatas));return[].concat(g.u0(new Set(p)))};
g.A(cNa,Ny);cNa.prototype.S=function(){var p=[];this.L.playbackData&&p.push(this.L.playbackData);this.L.localImageEntities&&p.push.apply(p,g.u0(this.L.localImageEntities));this.L.videoDownloadContextEntity&&p.push(this.L.videoDownloadContextEntity);return[].concat(g.u0(new Set(p)))};
g.A(uXa,Ny);uXa.prototype.S=function(){var p=[];this.L.musicLibraryStatusEntity&&p.push(this.L.musicLibraryStatusEntity);this.L.primaryArtists&&p.push.apply(p,g.u0(this.L.primaryArtists));this.L.details&&p.push(this.L.details);this.L.userDetails&&p.push(this.L.userDetails);this.L.tracks&&p.push.apply(p,g.u0(this.L.tracks));this.L.share&&p.push(this.L.share);this.L.downloadMetadata&&p.push(this.L.downloadMetadata);this.L.refresh&&p.push(this.L.refresh);return[].concat(g.u0(new Set(p)))};
g.A(V0b,Ny);V0b.prototype.S=function(){var p=[];this.L.albumRelease&&p.push(this.L.albumRelease);this.L.tracks&&p.push.apply(p,g.u0(this.L.tracks));return[].concat(g.u0(new Set(p)))};
g.A(o3a,Ny);o3a.prototype.S=function(){var p=[];this.L.albumRelease&&p.push(this.L.albumRelease);return[].concat(g.u0(new Set(p)))};
g.A(yX8,Ny);yX8.prototype.S=function(){var p=[];this.L.details&&p.push(this.L.details);this.L.userDetails&&p.push(this.L.userDetails);return[].concat(g.u0(new Set(p)))};
g.A(yNb,Ny);yNb.prototype.S=function(){var p=[];this.L.parentArtist&&p.push(this.L.parentArtist);return[].concat(g.u0(new Set(p)))};
g.A(G32,Ny);G32.prototype.S=function(){var p=[];this.L.parentArtist&&p.push(this.L.parentArtist);return[].concat(g.u0(new Set(p)))};
g.A(EqK,Ny);EqK.prototype.S=function(){return[]};
g.A(JN_,Ny);JN_.prototype.S=function(){return[]};
g.A(I2M,gL);I2M.prototype.S=function(){var p=[];this.L.creatorEntity&&p.push(this.L.creatorEntity);return[].concat(g.u0(new Set(p)))};
g.A(TB_,Ny);
TB_.prototype.S=function(){var p=[];this.L.tracks&&p.push.apply(p,g.u0(this.L.tracks));this.L.refresh&&p.push(this.L.refresh);this.L.musicLibraryStatusEntity&&p.push(this.L.musicLibraryStatusEntity);this.L.details&&p.push(this.L.details);this.L.downloadMetadata&&p.push(this.L.downloadMetadata);this.L.sideloadMetadata&&p.push(this.L.sideloadMetadata);this.L.userDetails&&p.push(this.L.userDetails);this.L.entryCollection&&p.push(this.L.entryCollection);this.L.share&&p.push(this.L.share);this.L.podcastShowAdditionalMetadata&&
p.push.apply(p,g.u0((new I2M(this.L.podcastShowAdditionalMetadata)).S()));return[].concat(g.u0(new Set(p)))};
g.A(YO_,Ny);YO_.prototype.S=function(){return[]};
g.A(Nhl,Ny);
Nhl.prototype.S=function(){var p=[];this.L.musicLibraryStatusEntity&&p.push(this.L.musicLibraryStatusEntity);this.L.artists&&p.push.apply(p,g.u0(this.L.artists));this.L.audioModeVersion&&p.push(this.L.audioModeVersion);this.L.videoModeVersion&&p.push(this.L.videoModeVersion);this.L.userDetails&&p.push(this.L.userDetails);this.L.details&&p.push(this.L.details);this.L.albumRelease&&p.push(this.L.albumRelease);this.L.share&&p.push(this.L.share);this.L.libraryEdit&&p.push(this.L.libraryEdit);this.L.downloadMetadata&&
p.push(this.L.downloadMetadata);this.L.playbackPosition&&p.push(this.L.playbackPosition);this.L.lyrics&&p.push(this.L.lyrics);return[].concat(g.u0(new Set(p)))};
g.A(sqb,Ny);sqb.prototype.S=function(){var p=[];this.L.parentTrack&&p.push(this.L.parentTrack);return[].concat(g.u0(new Set(p)))};
g.A(MF_,Ny);MF_.prototype.S=function(){var p=[];this.L.parentTrack&&p.push(this.L.parentTrack);return[].concat(g.u0(new Set(p)))};
g.A(xAB,Ny);xAB.prototype.S=function(){return[]};
g.A(m6W,Ny);m6W.prototype.S=function(){return[]};
g.A(QbW,Ny);QbW.prototype.S=function(){return[]};
g.A(cAb,Ny);cAb.prototype.S=function(){return[]};
g.A(jKl,Ny);jKl.prototype.S=function(){var p=[];this.L.transfer&&p.push(this.L.transfer);this.L.adsPlaybackData&&p.push.apply(p,g.u0(this.L.adsPlaybackData));this.L.drmLicense&&p.push(this.L.drmLicense);this.L.offlineVideoPolicy&&p.push(this.L.offlineVideoPolicy);this.L.videoDownloadContextEntity&&p.push(this.L.videoDownloadContextEntity);return[].concat(g.u0(new Set(p)))};
g.A(aq1,Ny);aq1.prototype.S=function(){return[]};
g.A(Z6U,Ny);Z6U.prototype.S=function(){var p=[];this.L.offlineVideoStreams&&p.push.apply(p,g.u0(this.L.offlineVideoStreams));this.L.captionTrack&&p.push.apply(p,g.u0(this.L.captionTrack));return[].concat(g.u0(new Set(p)))};
g.A($$1,Ny);$$1.prototype.S=function(){return[]};
g.A(AX_,Ny);AX_.prototype.S=function(){return[]};
g.A(Pil,Ny);Pil.prototype.S=function(){return[]};
g.A(csG,Ny);csG.prototype.S=function(){return[]};
g.A(RCb,Ny);RCb.prototype.S=function(){return[]};
g.A(Pv8,Ny);Pv8.prototype.S=function(){return[]};
g.A(Voc,Ny);Voc.prototype.S=function(){return[]};
g.A(hC_,Ny);hC_.prototype.S=function(){return[]};
g.A(XQ_,Ny);XQ_.prototype.S=function(){return[]};
g.A(oPU,Ny);oPU.prototype.S=function(){return[]};
g.A(liM,Ny);liM.prototype.S=function(){return[]};
g.A(Fga,Ny);Fga.prototype.S=function(){return[]};
g.A(toM,Ny);toM.prototype.S=function(){return[]};
g.A(WD2,Ny);WD2.prototype.S=function(){return[]};
g.A(k3G,Ny);k3G.prototype.S=function(){return[]};
g.A(fi_,Ny);fi_.prototype.S=function(){return[]};
g.A(D6_,Ny);D6_.prototype.S=function(){return[]};
g.A(dAK,Ny);dAK.prototype.S=function(){return[]};
g.A(hPU,Ny);hPU.prototype.S=function(){return[]};
g.A(tPb,Ny);tPb.prototype.S=function(){return[]};
g.A(QY8,Ny);QY8.prototype.S=function(){return[]};
g.A(Wg1,Ny);Wg1.prototype.S=function(){return[]};
var ai8=["browse","music/browse","unplugged/browse"],VZB=["offline/playlist_sync_check"],ONb=["offline"],rU_=["offline/offline_video_playback_position_sync"],AU1=["offline/get_playback_data_entity"],DZ;Vf.getInstance=function(){return g.R(function(p){return p.return(new Promise(function(a){g.Nb().then(function(l){l?(Vf.instance||(Vf.instance=new Vf(l)),a(Vf.instance)):a(void 0)})}))})};
Vf.prototype.get=function(p){var a=this,l,y,S;return g.R(function(n){if(n.L==1)return g.u(n,MZl(a.token),2);if(n.L!=3)return l=n.S,g.u(n,l.get("prefs",p),3);y=n.S;if(!y)return n.return();S=(0,g.Ek)();return y.expirationTimestampMs<=S?n.return():n.return(y.value)})};
Vf.prototype.set=function(p,a,l){l=l===void 0?31536E3:l;var y=this,S,n,V;return g.R(function(z){if(z.L==1)return S=(0,g.Ek)(),n={key:p,value:a,expirationTimestampMs:S+l*1E3},g.u(z,MZl(y.token),2);V=z.S;return g.u(z,g.RM(V,"prefs",n),0)})};
Vf.prototype.remove=function(p){var a=this,l;return g.R(function(y){if(y.L==1)return g.u(y,MZl(a.token),2);l=y.S;return g.u(y,l.delete("prefs",p),0)})};
g.A(nS,g.kc);g.A(HC,gqM);HC.prototype.U=function(p,a){a=KWb(a);p=(new TextEncoder).encode(JSON.stringify(p));return this.L.encrypt(p,a)};
HC.prototype.S=function(p,a){if(!(p instanceof Uint8Array))throw lqc(1);var l=new TextDecoder;a=KWb(a);p=this.L.decrypt(p,a);return JSON.parse(l.decode(p))};
var qi_={accountLinkStatusEntity:D81,booleanEntity:WLG,buttonEntity:k3G,captionTrack:xAB,channelHandle:RI8,chipEntity:Voc,commerceAcquisitionClientPayloadEntity:D6_,commerceCartListEntity:dAK,compositeSourceEntity:eIc,multiviewStagingEntity:FWM,contextNoteFeedEntityPayload:X5K,contextNoteUserRatingEntityPayload:iPc,continuationTokenEntity:nPb,downloadQualityPickerEntity:oW1,downloadsPageRefreshTokenEntity:sYb,downloadsPageViewConfigurationEntity:UxU,downloadStatusEntity:lnc,dismissState:hC_,sfvAudioItemCurrentlyPlayingEntity:csG,
emojiFountainDataEntity:toM,emojiCustomizationSetEntity:Fga,fakeChannel:zyl,fakePlaylist:vWl,fakePlaylistEntryCollection:aV8,fakeVideo:SiK,fakeVideoDescription:HPa,featuredProductsEntity:JAW,flowStateEntity:Hl2,iconBadgeEntity:hPU,interstitialInteractionStateEntity:jYl,likeButtonAnimationEntity:p38,liveChatPollStateEntity:rsW,dataFreshnessEntity:liM,liveViewerLeaderboardChatEntryPointStateEntity:AX_,liveViewerLeaderboardPointsEntity:Pil,liveReactionsDataEntity:WD2,logoEntity:IVW,macroMarkerEntity:x6W,
mainDownloadsLibraryEntity:TM2,mainDownloadsListEntity:IqU,mainPlaylistDownloadStateEntity:XVl,mainPlaylistEntity:NBK,mainPlaylistVideoEntity:vvB,mainVideoDownloadStateEntity:e_W,mainVideoEntity:SO1,markersEngagementPanelSyncEntity:jb1,markersVisibilityOverrideEntity:LPM,musicAlbumReleaseDetail:V0b,musicAlbumReleaseDownloadMetadataEntity:d6G,musicAlbumRelease:uXa,musicAlbumReleaseUserDetail:o3a,musicArtistDetail:yNb,musicArtist:yX8,musicArtistUserDetail:G32,musicDownloadsLibraryEntity:ITc,musicLibraryEdit:EqK,
musicLibraryStatusEntity:JN_,musicPlaylist:TB_,musicPlaylistDownloadMetadataEntity:Asb,musicShare:YO_,musicTrackDetail:sqb,musicTrackDownloadMetadataEntity:cNa,musicTrack:Nhl,musicTrackUserDetail:MF_,offlineOrchestrationActionWrapperEntity:m6W,offlineVideoPolicy:QbW,offlineVideoStreams:cAb,offlineabilityEntity:KyG,orchestrationWebSamplingEntity:Tb7,pageHeaderEntity:XQ_,pdpStateEntity:tPb,pinnedProductEntity:xjU,playbackData:jKl,playerStateEntity:kAG,quantityIncrementerEntity:QY8,refresh:aq1,saveToPlaylistListEntity:RCb,
selectedChipIndexEntityPayload:ykG,settingEntity:Pv8,stringEntity:NMb,suggestedFeedbackChipStateEntity:WWG,transfer:Z6U,trendingOfferEntity:S3l,videoDownloadContextEntity:$$1,videoOverviewAsyncDataEntity:Wg1,videoPlaybackPositionEntity:fi_,votingEntity:oPU,ytMainChannelEntity:ThB,youchatPendingResponseEntity:blM,ytMainDownloadedVideoEntity:ovc,ytMainVideoEntity:nW1};g.A(Ai,gqM);Ai.prototype.U=function(p){return p};
Ai.prototype.S=function(p){if(p instanceof Uint8Array)throw lqc(0);return p};
g.A(LS,g.D);LS.prototype.observe=function(p){var a=this;this.observers.push(p);return function(){var l=a.observers.indexOf(p);l>=0&&a.observers.splice(l,1)}};
LS.prototype.S=function(p){rN_(this,p.data)};
LS.prototype.fz=function(){this.channel.close()};
var kfW,zCW=new g.IR("elementsCommand");var gS=new g.IR("entityBatchUpdate");var LDM=new g.IR("downloadStatusEntity");var iN_=new g.IR("mainPlaylistEntityActionMetadata");var qy=new g.IR("mainVideoEntityActionMetadata");var Nba=new g.IR("musicPlaylistEntityActionMetadata");var d$c=new g.IR("musicTrackEntityActionMetadata");var QJW=new g.IR("localImageEntityActionMetadata");var Yf=new g.IR("playbackDataActionMetadata");var zI7=new g.IR("transferEntityActionMetadata");var eCb=new g.IR("videoPlaybackPositionEntityActionMetadata");var AN2;new g.rQ;new g.rQ;$jM.prototype.request=function(p,a,l){a=a===void 0?{}:a;return this.locks.request(p,a,function(y){return l(y)})};var hi=g.dD.caches,Qf,ys_;EN.prototype.open=function(p){return hi.open(YCW(p))};
EN.prototype.has=function(p){return hi.has(YCW(p))};
EN.prototype.delete=function(p){return hi.delete(YCW(p))};
EN.prototype.match=function(p,a){var l=this,y,S,n,V,z,d;return g.R(function(G){switch(G.L){case 1:return g.u(G,l.keys(),2);case 2:y=G.S,S=g.t(y),n=S.next();case 3:if(n.done){G.g7(5);break}V=n.value;return g.u(G,l.open(V),6);case 6:return z=G.S,g.u(G,z.match(p,a),7);case 7:if(d=G.S)return G.return(d);n=S.next();G.g7(3);break;case 5:return G.return()}})};
g.A(CTW,EN);CTW.prototype.keys=function(){var p,a,l,y,S,n,V,z,d;return g.R(function(G){if(G.L==1)return p=[],a=g.Bi("CacheStorage keys"),g.u(G,hi.keys(),2);l=G.S;y=g.t(l);for(S=y.next();!S.done;S=y.next()){n=S.value;var B=n.indexOf(":");V=B===-1?{LQ:n}:{LQ:n.substring(0,B),datasyncId:n.substring(B+1)};z=V.LQ;d=V.datasyncId;d===a&&p.push(z)}return G.return(p)})};g.A(ti,g.D);ti.prototype.U=function(p){this.api.xv("onOfflineOperationFailure",p.data)};
ti.prototype.j=function(p){this.api.publish("offlinetransferpause",p.data)};
ti.prototype.fz=function(){var p;(p=this.L)==null||p.close();var a;(a=this.S)==null||a.close()};kYU.prototype.JN=function(){this.L&&Y6(this)};
kYU.prototype.TX=function(){this.S&&this.S.resolve();this.U=this.L=!1;this.Sl()};var VFc=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var BhK="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var ErB="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.A(R_8,qq);R_8.prototype.S=function(p){return kf(p)?wGl(this,p):Tn(p)?yUa(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.A(zBc,qq);zBc.prototype.S=function(p){return Tn(p)?AAc(this,p):LgW(p)?b6M(this,p):FQ(p)?hI_(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.L=EP2.prototype;g.L.paI=function(p){var a=this,l,y,S,n;return g.R(function(V){if(!g.h(p.state,128))return V.g7(0);l=p.state.iN;var z=(y=l)==null?void 0:y.errorCode,d=(S=l)==null?void 0:S.pJ;n=z==="net.connect"&&d===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(z==null?0:z.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.u(V,a.Fk(a.player.getVideoData().videoId,n),0)})};
g.L.Fk=function(p,a){var l=this;return g.R(function(y){if(y.L==1){if(l.S)return y.return();l.S=!0;return a==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(a3(l,p,!1,!0),y.g7(0)):g.u(y,le(l,p),3)}g.Uy(p,4);return g.u(y,l.L.Fk(a),0)})};
g.L.PR=function(p){p.status===2?(p.status!==this.U&&(Qe7(this.L),g.Uy(p.videoId,2)),p.Nr&&orG(this.L,p.videoId,p.Nr)):p.status===4?(le(this,p.videoId),this.Fk(p.videoId,p.vV?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):p.status===1&&sbG(this.L);this.U=p.status;this.api.xv("localmediachange",{videoId:p.videoId,status:p.status})};
g.L.gw=function(){var p=this,a;return g.R(function(l){if(l.L==1){if(p.S)return l.return();p.S=!0;a=p.player.getVideoData().videoId;return g.u(l,le(p,a),2)}return g.u(l,p.L.gw(),0)})};
g.L.VW=function(p){switch(p){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.L.D=function(p){return this.api.C().D(p)};g.A(Kg_,qq);Kg_.prototype.S=function(p){return kf(p)?k9B(this,p):Tn(p)?qU_(this,p):LgW(p)?O6_(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};FDa.prototype.L=function(p,a){var l=p.action.actionMetadata.priority-a.action.actionMetadata.priority;l===0&&(p.L<a.L?l=-1:p.L>a.L&&(l=1));return l};g.A(UN,g.D);UN.prototype.fz=function(){this.Sl&&this.Sl();g.D.prototype.fz.call(this)};
UN.prototype.createAction=function(p,a){var l=g.xj(p.entityKey).entityType,y=g.VI(16);return new ue(l,y,p,a.actionId,a.rootActionId)};
UN.prototype.Xu=function(p){var a=this,l,y,S,n,V,z,d,G,B;return g.R(function(c){if(c.L==1){if(a.Gm())return c.return();y=(l=p.offlineOrchestrationActionWrapperEntity)!=null?l:new Set;S=[];n=g.t(y);for(V=n.next();!V.done;V=n.next())z=V.value,d=g.xj(z),G=d.entityId,an7(a.L,G)||S.push(z);return g.u(c,bIb(a,S),2)}B=c.S;return g.u(c,QK_(a,B),0)})};
UN.prototype.retry=function(){var p=this;return g.R(function(a){return g.u(a,h__(p),0)})};Ck_.prototype.q0=function(p,a){a=a===void 0?!0:a;var l=this,y,S,n,V,z,d,G,B;return g.R(function(c){switch(c.L){case 1:if(!l.L)return c.return();y=[];S=g.Rv(l.L.S,a);n=[];for(V={Af:0};V.Af<S.length;V={Af:V.Af},V.Af++)z=S[V.Af],d=l.L.Jn(z,"json3"),G=g.bR(d,{withCredentials:!0,format:"RAW"},3,500).then(function(r){return function(w){w={metadata:g.Xp(S[r.Af]),trackData:w.xhr.responseText};n.push(w)}}(V)).Nb(function(r){Dy("Caption fetch error",r)}),y.push(G);
return g.u(c,CE8(y),2);case 2:return g.$r(c,3),g.u(c,z_c(p,n),5);case 5:g.L8(c,0);break;case 3:B=g.L6(c),Dy("Caption DB transaction error",B),g.lD(c)}})};g.A(yf,g.D);yf.prototype.fz=function(){this.S&&this.S();g.D.prototype.fz.call(this)};
yf.prototype.U=function(p){var a=this,l,y,S,n,V,z,d,G;return g.R(function(B){y=(l=p.transfer)!=null?l:new Set;S=[];n=g.t(y);for(V=n.next();!V.done;V=n.next())z=V.value,d=g.xj(z),G=d.entityId,S.push(G);return S.length===0?B.return():g.u(B,Pxc(a,S),0)})};g.A(vPU,g.D);g.L=vPU.prototype;g.L.fz=function(){this.w7&&this.w7();this.Bs.dispose();this.j.dispose();this.Hs&&g.Lm(this.G.BL,this.Hs);this.t9&&g.Lm(this.G.BL,this.t9);g.D.prototype.fz.call(this)};
g.L.b1m=function(p){var a=this,l,y,S;return g.R(function(n){switch(n.L){case 1:l=g.m8(p,"transfer");if(a.L&&l===a.L.key){a3(a.K,a.W,!0);a.j.stop();n.g7(0);break}return g.u(n,rS(a.S,{mode:"readwrite",Gn:!0},function(V){return wS(V,l,"transfer").then(function(z){if(z&&z.transferState!=="TRANSFER_STATE_COMPLETE"&&z.transferState!=="TRANSFER_STATE_FAILED")return z.transferState="TRANSFER_STATE_PAUSED_BY_USER",$f(V,z,"transfer").then(function(){return z})})}),3);
case 3:y=n.S;if(!y){n.g7(0);break}if(!p||!a.U){n.g7(5);break}return g.u(n,CS(p,a.U,a.S,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.u(n,UJ(a,p),7);case 7:S=n.S,HNM({videoId:p,F_:y,offlineModeType:S}),g.lD(n)}})};
g.L.g3l=function(){var p=this;if(this.L&&this.W){a3(this.K,this.W,!1);var a=this.L,l=(a==null?0:a.key)?g.xj(a.key).entityId:"";l&&this.U&&(new Promise(function(y,S){CS(l,p.U,p.S,"DOWNLOAD_STATE_PAUSED").catch(function(n){S(n)})})).catch(function(y){Dy("Download state setting error",y)})}this.j.stop()};
g.L.G5=function(){this.L?q9l(this,this.L):KS(this)};
g.L.Z9=function(p){var a=this;return g.R(function(l){switch(l.L){case 1:if(!a.L){l.g7(2);break}if(a.L.transferState==="TRANSFER_STATE_COMPLETE"||a.L.transferState==="TRANSFER_STATE_FAILED"||!p.transfer||!p.transfer.has(a.L.key)){l.g7(3);break}return g.u(l,tS(a.S,a.L.key,"transfer"),4);case 4:a.L=l.S;if(a.L){l.g7(3);break}return g.u(l,Fxl(a),3);case 3:if(a.L)return l.return();case 2:return g.u(l,KS(a),0)}})};
g.L.Fk=function(p,a){var l=this,y,S,n,V,z;return g.R(function(d){switch(d.L){case 1:if(!l.L){JS(l,"onTransferFailure: "+p);d.g7(2);break}y=l.L;n=((S=y)==null?0:S.key)?g.xj(y.key).entityId:"";a:switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var G=!1;break a;default:G=!0}return G&&yAl(l)?g.u(d,pS(l,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.u(d,
XGb(l,p),5);case 5:if(!n||!l.U){d.g7(2);break}return g.u(d,CS(n,l.U,l.S,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.u(d,UJ(l,n),9);case 9:V=d.S;QS({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:n,F_:y,offlineModeType:V});if(!n||!l.U){d.g7(2);break}return g.u(d,CS(n,l.U,l.S,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:vC(l),z=KS(l,!0),a&&a(z),g.lD(d)}})};
g.L.gw=function(p){var a=this,l,y,S,n,V,z,d,G,B,c,r,w;return g.R(function(P){switch(P.L){case 1:if(!a.L){JS(a,"onMaybeTransferStreamsExpired");P.g7(2);break}return yAl(a)?g.u(P,pS(a,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.u(P,XGb(a,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!a.U){P.g7(2);break}l=a.L;S=((y=l)==null?0:y.key)?g.xj(l.key).entityId:"";if(!S){P.g7(2);break}return g.u(P,CS(S,a.U,a.S,"DOWNLOAD_STATE_FAILED"),2);case 9:return a.L||JS(a,"onMaybeTransferStreamsExpiredRetryAttempting"),
n=a.L,z=((V=n)==null?0:V.key)?g.xj(n.key).entityId:"",g.u(P,UJ(a,z),10);case 10:return d=P.S,QS({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:z,F_:n,offlineModeType:d}),G=v3B(),g.HD(G,Yf,{isEnqueuedForExpiredStreamUrlRefetch:!0}),B=g.m8(z,"playbackData"),c={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:B,actionMetadata:G},r=ON(new ue("playbackData",z,c)),g.u(P,PC(a.S,r,"offlineOrchestrationActionWrapperEntity"),2);case 2:vC(a),w=KS(a,!0),
p&&p(w),g.lD(P)}})};
var qCG={},t0c=(qCG.TRANSFER_STATE_TRANSFERRING=1,qCG.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,qCG);g.L=be.prototype;g.L.Sw=function(){return this.W.promise};
g.L.QD=function(){if(this.S&&this.K)return this.W.promise;pGl(this).then(this.W.resolve).catch(this.W.reject);return this.W.promise};
g.L.Ki=function(p){var a={};return a.playbackData=new R_8(p,this.Y,this.L),a.transfer=new Kg_(p,this.Y),a.videoPlaybackPositionEntity=new zBc(p,this.Y),a};
g.L.rF=function(){var p=this;return g.R(function(a){return p.S?g.u(a,tF_(p.S),0):a.g7(0)})};
g.L.Hg=function(){var p=this,a,l;return g.R(function(y){if(y.L==1)return p.S||p.K?g.u(y,p.Sw(),2):y.return();p.Z!==void 0&&(g.pA(p.Z),p.Z=void 0);p.j!==void 0&&(g.pA(p.j),p.j=void 0);(a=p.S)==null||a.dispose();p.S=void 0;(l=p.K)==null||l.dispose();p.K=void 0;p.api.xv("onOrchestrationLostLeader");p.W=new g.rQ;g.lD(y)})};
g.L.isOrchestrationLeader=function(){return this.U.L};
g.L.oG=function(){return g.R(function(p){return p.return(!1)})};
g.L.OH=function(p){var a=this.L;a.api.publish("offlinetransferpause",p);var l;(l=a.S)==null||l.postMessage(p)};
g.L.G5=function(p){var a,l;return g.R(function(y){if(y.L==1)return g.u(y,dS(),2);a=y.S;if(!a)return y.return();l=g.m8(p,"transfer");return g.u(y,rS(a,{mode:"readwrite",Gn:!0},function(S){var n=wS(S,l,"transfer"),V=wS(S,g.m8(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Qn.all([n,V]).then(function(z){z=g.t(z);var d=z.next().value;var G=z.next().value;return d&&d.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(d.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",$f(S,d,"transfer").then(function(){QS({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:p,F_:d,offlineModeType:G==null?void 0:G.offlineModeType});return g.Qn.resolve(null)})):g.Qn.resolve(null)})}),0)})};
g.L.dF=function(p){p=p===void 0?43200:p;var a=this,l,y,S,n,V,z,d,G;return g.R(function(B){if(B.L==1)return a.G.Dd()?g.u(B,dS(),2):B.return(gr2());if(B.L!=3){l=B.S;if(!l)return B.return([]);y=Date.now()/1E3;return g.u(B,mi(l,"offlineVideoPolicy"),3)}S=B.S;n=[];V=g.t(S);for(z=V.next();!z.done;z=V.next())d=z.value,Number(d.lastUpdatedTimestampSeconds)+p<=y&&(G=g.xj(d.key).entityId,n.push(G));return n.length?B.return(j7(a,n,a.Sl,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):B.return([])})};
g.L.deleteAll=function(){return j7(this,["!*$_ALL_ENTITIES_!*$"],this.Sl,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.L.refreshAllStaleEntities=function(p){var a=this;return g.R(function(l){return l.L==1?g.u(l,a.dF(p),2):l.return(l.S)})};
g.L.setUpPositionSyncInterval=function(p){var a=this;this.j!==void 0&&(g.pA(this.j),this.j=void 0);var l=p!=null?p:864E5;this.j=g.Vo(function(){a.s7(l)},l)};
g.L.s7=function(p){var a=this,l,y,S,n,V,z;return g.R(function(d){switch(d.L){case 1:return g.$r(d,2),g.u(d,Vf.getInstance(),4);case 4:l=d.S;if(!l)throw Error("prefStorage is undefined");return g.u(d,l.get("psi"),5);case 5:y=d.S;n=((S=y)==null?0:S.H7)?Number(y.H7)/1E3:0;V=Date.now();if(!(n+p<=V)){d.g7(6);break}return g.u(d,j7(a,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.L8(d,0);break;case 2:z=g.L6(d),Dy("Offline manager error",z),
g.lD(d)}})};
g.L.t_=function(){var p=this,a,l,y,S,n,V,z;return g.R(function(d){if(d.L==1)return g.u(d,dS(),2);if(d.L!=3)return(a=d.S)?g.u(d,mi(a,"transfer"),3):d.return([]);l=d.S;y=[];S=g.t(l);for(n=S.next();!n.done;n=S.next())V=n.value,V.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&V.key&&(z=g.xj(V.key).entityId,y.push(z));return d.return(SCb(p,y))})};
g.L.n2=function(){return g.R(function(p){return p.return([])})};
g.L.vK=function(){return g.R(function(p){g.lD(p)})};
g.L.z7=function(){return g.R(function(p){g.lD(p)})};g.A(m$c,qq);m$c.prototype.S=function(p){return kf(p)?qZc(this,p):Tn(p)?hBc(this,p):FQ(p)?rAa(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var xf=[10];g.A(G9W,qq);G9W.prototype.S=function(p){return kf(p)?LW1(this,p):Tn(p)?mjc(this,p):FQ(p)?$Ac(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var Pk2=[10];g.A(djG,qq);djG.prototype.S=function(p){return Tn(p)?hyB(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.A(EWM,be);g.L=EWM.prototype;g.L.Ki=function(p){var a=be.prototype.Ki.call(this,p);a.mainVideoEntity=new G9W(p,this.Y,this.L);a.mainPlaylistEntity=new m$c(p,this.Y,this.L);a.mainDownloadsListEntity=new djG(p,this.Y,this.L);return a};
g.L.refreshAllStaleEntities=function(p,a){var l=this,y,S,n,V,z,d,G,B,c,r,w;return g.R(function(P){switch(P.L){case 1:y=[];if(!l.Y.D("web_player_offline_playlist_auto_refresh")){P.g7(2);break}return g.u(P,i6K(l,p,a),3);case 3:y=P.S;case 2:return g.u(P,Vf.getInstance(),4);case 4:return S=P.S,g.u(P,(n=S)==null?void 0:n.get("sdois"),5);case 5:return V=P.S,g.u(P,(z=S)==null?void 0:z.get("lmqf"),6);case 6:d=P.S;if(!V){P.g7(7);break}B=y;c=B.concat;return g.u(P,cUa(l,V,(G=d)!=null?G:"SD",p===0),8);case 8:y=
c.call(B,P.S);case 7:return r=y,w=r.concat,g.u(P,be.prototype.refreshAllStaleEntities.call(l,p,a),9);case 9:return y=w.call(r,P.S),P.return(y)}})};
g.L.oG=function(p){var a,l,y,S,n,V,z,d;return g.R(function(G){if(G.L==1)return g.u(G,dS(),2);if(G.L!=3)return(a=G.S)?g.u(G,tS(a,g.M2,"mainDownloadsListEntity"),3):G.return(!1);l=G.S;if((y=l)==null?0:(S=y.downloads)==null?0:S.length)for(n=g.m8(p,"mainVideoEntity"),V=g.t(l.downloads),z=V.next();!z.done;z=V.next())if(d=z.value,d.videoItem===n)return G.return(!0);return G.return(!1)})};
g.L.n2=function(){var p=this,a,l,y,S,n,V,z,d;return g.R(function(G){if(G.L==1)return g.u(G,dS(),2);if(G.L!=3)return(a=G.S)?g.u(G,mi(a,"downloadStatusEntity"),3):G.return([]);l=G.S;y=[];S=g.t(l);for(n=S.next();!n.done;n=S.next())V=n.value,V.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&V.key&&(z=g.xj(V.key).entityId,y.push(z));return y.length?(d={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},G.return(j7(p,y,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
d))):G.return([])})};
g.L.z7=function(){var p;return g.R(function(a){return a.L==1?g.u(a,dS(),2):(p=a.S)?g.u(a,rS(p,{mode:"readwrite",Gn:!0},function(l){return fQ(l,"mainVideoEntity").then(function(y){var S=[];y=g.t(y);for(var n=y.next();!n.done;n=y.next()){n=n.value;var V=void 0;(V=n.userState)!=null&&V.playbackPosition||(V=g.xj(n.key).entityId,V={key:g.m8(V,"videoPlaybackPositionEntity"),videoId:V,lastPlaybackPositionSeconds:"0"},S.push($f(l,V,"videoPlaybackPositionEntity")),n.userState={playbackPosition:V.key},S.push($f(l,
n,"mainVideoEntity")))}return g.Qn.all(S)})}),0):a.return()})};
g.L.vK=function(){var p,a,l,y,S,n,V,z,d,G,B,c,r,w,P,F,v,I,b,O,m,H,Y,N,yo,zq,S$,BE,f,xh,Nf,nc,yU,kh,OM,q7,u_,i_;return g.R(function(p8){if(p8.L==1)return g.u(p8,dS(),2);if(p8.L!=3){p=p8.S;if(!p)return p8.return();a=g.m8("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.u(p8,rS(p,{mode:"readonly",Gn:!0},function(G5){return g.Qn.all([wS(G5,a,"mainDownloadsListEntity"),wS(G5,g.M2,"mainDownloadsListEntity"),fQ(G5,"mainVideoEntity"),fQ(G5,"mainPlaylistEntity")])}),3)}l=p8.S;
y=g.t(l);S=y.next().value;n=y.next().value;V=y.next().value;z=y.next().value;d=S;G=n;B=V;c=z;r=new Set;if((w=d)==null?0:(P=w.downloads)==null?0:P.length)for(F=g.t(d.downloads),v=F.next();!v.done;v=F.next())I=v.value,b=void 0,(O=(b=I.videoItem)!=null?b:I.playlistItem)&&r.add(O);if((m=G)==null?0:(H=m.downloads)==null?0:H.length)for(Y=g.t(G.downloads),N=Y.next();!N.done;N=Y.next())yo=N.value,yo.videoItem&&r.add(yo.videoItem);zq=new Set;S$=[];BE=g.t(c);for(f=BE.next();!f.done;f=BE.next()){xh=f.value;
if(xh.videos)for(Nf=g.t(xh.videos),nc=Nf.next();!nc.done;nc=Nf.next())yU=nc.value,(kh=JSON.parse(g.xj(yU).entityId).videoId)&&zq.add(kh);xh.key&&!r.has(xh.key)&&S$.push(xh.key)}OM=g.t(B);for(q7=OM.next();!q7.done;q7=OM.next())u_=q7.value,u_.key&&!r.has(u_.key)&&(i_=g.xj(u_.key).entityId,zq.has(i_)||S$.push(u_.key));return S$.length?g.u(p8,U$b(p,S$),0):p8.g7(0)})};g.A(b$2,qq);b$2.prototype.S=function(p){return kf(p)?Lx7(this,p):Tn(p)?tBG(this,p):FQ(p)?BBc(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var Hm=[10];g.A(H$K,qq);H$K.prototype.S=function(p){return kf(p)?UAK(this,p):Tn(p)?UjW(this,p):FQ(p)?DAl(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var sN=[10];g.A(H6c,qq);H6c.prototype.S=function(p){return kf(p)?rkU(this,p):Tn(p)?buU(this,p):FQ(p)?vrc(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var ckU=[10];g.A(ie,be);ie.prototype.Ki=function(p){var a=be.prototype.Ki.call(this,p);a.musicTrack=new H6c(p,this.L);a.musicPlaylist=new H$K(p,this.L);a.musicAlbumRelease=new b$2(p,this.L);return a};
ie.prototype.refreshAllStaleEntities=function(p,a){var l=this,y,S,n;return g.R(function(V){if(V.L==1)return g.u(V,MPW(l,p,a),2);if(V.L!=3)return S=y=V.S,n=S.concat,g.u(V,be.prototype.refreshAllStaleEntities.call(l,p,a),3);y=n.call(S,V.S);return V.return(y)})};g.A(ZlB,g.N_);g.L=ZlB.prototype;g.L.create=function(){var p=this;g.E(this,this.events);if(g.Z0(this.Y))this.L=new EWM(this.Y,this.player);else if(g.dB(this.Y)||g.sf(this.Y))this.L=new ie(this.Y,this.player);this.events.J(this.player,"onPlaybackStartExternal",function(){p.qj()});
this.events.J(this.player,"videodatachange",function(){p.qj()});
this.Y.D("html5_offline_playback_position_sync")&&this.events.J(this.player,"presentingplayerstatechange",this.GN)};
g.L.Z_=function(){return!1};
g.L.VC=function(p,a,l,y){var S=this;return g.R(function(n){return S.L?n.return(j7(S.L,p,a,l,y)):n.return(Promise.reject())})};
g.L.deleteAll=function(){return this.L.deleteAll()};
g.L.dF=function(p){return this.L.dF(p)};
g.L.refreshAllStaleEntities=function(p){return this.L.refreshAllStaleEntities(p)};
g.L.setUpPositionSyncInterval=function(p){this.L.setUpPositionSyncInterval(p)};
g.L.OH=function(p){this.L.OH(p)};
g.L.G5=function(p){return this.L.G5(p)};
g.L.qj=function(){var p=this,a;return g.R(function(l){a=p.player.getVideoData();return g.Dh(a)?wVM(a)&&p.S!==a.clientPlaybackNonce?g.u(l,$6K(p,a),0):l.g7(0):l.return()})};
g.L.GN=function(p){var a=this,l,y,S,n,V,z,d;return g.R(function(G){if(G.L==1)return l=a.player.getVideoData(),y=l.bf,g.mj(p,2)||g.mj(p,512)?g.u(G,dS(),2):G.return();if(G.L!=3){S=G.S;if(!S)return Dy("PES is undefined"),G.return();n=l.videoId;return g.u(G,tS(S,g.m8(n,"mainVideoEntity"),"mainVideoEntity"),3)}V=G.S;if(!V)return G.return();z=Math.floor(y).toString();d={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:z}};return g.u(G,a.VC([n],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
d),0)})};
g.L.isOrchestrationLeader=function(){return this.L.isOrchestrationLeader()};
g.L.updateDownloadState=function(p,a){var l,y,S,n;return g.R(function(V){if(V.L==1)return g.u(V,dS(),2);l=V.S;if(!l)return Dy("PES is undefined"),V.return();y=g.xj(p);S=y.entityType;n=y.entityId;return g.u(V,CS(n,S,l,a,!0),0)})};g.Qg("offline",ZlB);})(_yt_player);
